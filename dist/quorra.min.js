!function(){function a(){}function b(b){a.log("instantiating quorra plot object"),"undefined"==typeof b&&(b={});var c=this;return this.go=function(b){a.log("running generator function"),"undefined"==typeof b&&(b=c.attr.bind),c.selection="string"==typeof b?d3.select(b):b,null!==c.selection.select("svg")[0][0]&&c.selection.select("svg").selectAll("*").remove(),c.attr.svg=null===c.attr.svg?c.selection.append("svg"):c.attr.svg;var d="auto"===c.attr.width?parseInt(c.selection.style("width")):c.attr.width,e="auto"===c.attr.height?parseInt(c.selection.style("height")):c.attr.height;if(c.innerwidth=d-c.attr.margin.left-c.attr.margin.right,c.innerheight=e-c.attr.margin.top-c.attr.margin.bottom,d3.selectAll("div.quorra-tooltip#"+c.attr.id+"-tooltip").remove(),c.attr.tooltip===!0&&(c.attr.tooltip=d3.select("body").append("div").attr("class","quorra-tooltip").attr("id",c.attr.id+"-tooltip").style("position","fixed").style("visibility","hidden").style("z-index",999)),c.attr.svg=c.attr.svg.attr("id",c.attr.id).attr("class",c.attr["class"]).attr("width",d).attr("height",e),c.defs=c.attr.svg.append("defs"),c.defs.append("clipPath").attr("id","clip-"+c.attr.id).append("rect").attr("x",0).attr("y",0).attr("width",c.innerwidth).attr("height",c.innerheight),c.plotregion=c.attr.svg.append("g").attr("class","plotregion").attr("transform","translate("+c.attr.margin.left+","+c.attr.margin.top+")"),c.data=c.attr.transform(c.attr.data),void 0!==c.data[0]){c.pallette="auto"===c.attr.color?d3.scale.category10():d3.scale.ordinal().range(c.attr.color),c.pallette=c.pallette.domain(p.uniquesort(c.data,c.attr.group)),"string"==typeof c.data[0].x?(c.attr.xorder.length>0?c.domain=c.attr.xorder:c.domain=p.uniquesort(c.data,c.attr.x),c.xdelta=1):(c.domain=[p.min(p.map(c.data,c.attr.x)),p.max(p.map(c.data,c.attr.x))],c.xdelta=Math.abs(c.domain[1]-c.domain[0])*c.pallette.length/c.data.length),"histogram"===c.type&&(c.domain[1]=c.domain[1]+(c.domain[1]-c.domain[0])/(c.attr.bins-1));var f;if("string"==typeof c.data[0].y)c.attr.yorder.length>0?c.range=c.attr.yorder:c.range=p.uniquesort(c.data,c.attr.y),c.ydelta=1;else{if("stacked"===c.attr.layout){var g=p.uniquesort(c.data,c.attr.x);f=p.max(p.map(g,function(a){var b=p.filter(c.data,function(b){return c.attr.x(b)==a}),d=p.map(b,function(a){return c.attr.y(a)});return p.reduce(d,function(a,b){return a+b},0)}))}else f=p.max(p.map(c.data,c.attr.y));c.range=[p.min(p.map(c.data,c.attr.y)),f],c.ydelta=Math.abs(c.range[1]-c.range[0])*c.pallette.length/c.data.length}}return c.enabled={zoom:!1,pan:!1,annotate:!1,crosshairs:!1},c.xstack=[],c.ystack=[],c.attr.legend&&c.drawlegend(),c.attr.zoomable&&c.enablezoom(),c.attr.annotatable&&c.enableannotation(),c.attr.glyphs&&c.drawglyphs(),c.redraw(),c.attr.slider&&c.slider(),c.attr.crosshairs&&c.enablecrosshairs(),c},this.redraw=function(b,d,e){a.log("redrawing plot"),"undefined"!=typeof b&&(c.attr.xrange=b),"undefined"!=typeof d&&(c.attr.yrange=d),"undefined"==typeof e&&(e=!0),c.plotregion.selectAll("*").remove(),c.axes(),c.plotarea=c.plotregion.append("g").attr("class","plotarea").attr("clip-path","url(#clip-"+c.attr.id+")"),c.plot(),e&&(c.xstack.push(c.xscale),c.ystack.push(c.yscale)),c.attr.annotation&&c.annotate()},this.axes=function(){a.log("redrawing axes");var b="auto"===c.attr.xrange?c.domain:c.attr.xrange,d="auto"===c.attr.yrange?c.range:c.attr.yrange;c.xmapper=function(a){return a},"string"==typeof c.data[0].x&&(c.xord=d3.scale.ordinal().domain(c.domain).range(p.range(c.domain.length)),c.xordrev=d3.scale.ordinal().domain(c.xord.range()).range(c.xord.domain()),c.xmapper=function(a){return c.xord(a)},"string"==typeof b[0]&&(b=p.map(b,c.xmapper),b[0]=b[0]-.5,b[b.length-1]=b[b.length-1]+.5)),c.xscale=d3.scale.linear().domain([b[0],b[b.length-1]]).range([0,c.innerwidth]),c.xmap=d3.scale.linear().domain(c.xscale.range()).range(c.xscale.domain()),c.xaxis=d3.svg.axis().scale(c.xscale).orient(c.attr.xorient),"auto"!==c.attr.xticks?c.xaxis=c.xaxis.ticks(c.attr.xticks):"histogram"===c.type&&(c.xaxis=c.xaxis.ticks(c.attr.bins)),c.xaxis=c.xaxis.tickFormat(c.attr.xformat),"string"==typeof c.data[0].x&&("string"==typeof b[0]&&(b=p.map(b,c.xord)),c.xaxis=c.xaxis.tickValues(p.range(Math.ceil(b[0]),Math.floor(b[b.length-1])+1)).tickFormat(function(a){var b=p.map(c.domain,c.xmapper);return a>=b[0]&&a<=b[b.length-1]?c.attr.xformat(c.xordrev(a)):""})),c.ymapper=function(a){return a},"string"==typeof c.data[0].y&&(c.yord=d3.scale.ordinal().domain(c.range).range(p.range(c.range.length)),c.yordrev=d3.scale.ordinal().domain(c.yord.range()).range(c.yord.domain()),c.ymapper=function(a){return c.yord(a)},"string"==typeof d[0]&&(d=p.map(d,c.ymapper),d[0]=d[0]-.5,d[d.length-1]=d[d.length-1]+.5)),c.yscale=d3.scale.linear().domain([d[0],d[d.length-1]]).range([c.innerheight,0]),c.ymap=d3.scale.linear().domain(c.yscale.range()).range(c.yscale.domain()),c.yaxis=d3.svg.axis().scale(c.yscale).orient(c.attr.yorient),"auto"!==c.attr.yticks&&(c.yaxis=c.yaxis.ticks(c.attr.yticks)),c.yaxis=c.yaxis.tickFormat(c.attr.yformat),"string"==typeof c.data[0].y&&("string"==typeof d[0]&&(d=p.map(d,c.yord)),c.yaxis=c.yaxis.tickValues(p.range(Math.ceil(d[0]),Math.floor(d[d.length-1])+1)).tickFormat(function(a){var b=p.map(c.range,c.ymapper);return a>=b[0]&&a<=b[b.length-1]?c.attr.yformat(c.yordrev(a)):""})),c.attr.grid&&(c.xaxis=c.xaxis.tickSize(-c.innerheight,0,0),c.yaxis=c.yaxis.tickSize(-c.innerwidth,0,0)),"hidden"!==c.attr.xaxis&&c.attr.xaxis!==!1&&c.plotregion.append("g").attr("class","x axis").attr("transform","translate(0,"+c.innerheight+")").call(c.xaxis).append("text").attr("class","label").attr("x",function(a){return"end"===c.attr.labelposition?c.innerwidth:"middle"===c.attr.labelposition?c.innerwidth/2:"start"===c.attr.labelposition?0:void 0}).attr("y",function(){return"inside"===c.attr.xaxis?-6+c.attr.labelpadding.x:"outside"===c.attr.xaxis?35+c.attr.labelpadding.x:void 0}).style("text-anchor",c.attr.labelposition).text(c.attr.xlabel),"hidden"!==c.attr.yaxis&&c.attr.yaxis!==!1&&c.plotregion.append("g").attr("class","y axis").call(c.yaxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",function(a){return"end"===c.attr.labelposition?0:"middle"===c.attr.labelposition?-c.innerheight/2:"start"===c.attr.labelposition?-c.innerheight:void 0}).attr("y",function(){return"inside"===c.attr.yaxis?6+c.attr.labelpadding.y:"outside"===c.attr.yaxis?-40+c.attr.labelpadding.y:void 0}).attr("dy",".71em").style("text-anchor",c.attr.labelposition).text(c.attr.ylabel)},this.plot=function(){a.log("To be implemented by models ...")},this.annotate=function(){a.log("drawing plot annotation"),p.map(c.attr.annotation,function(b){a.render(b)})},this.slider=function(){if(a.log("instantiating plot slider"),null!=c.attr.slider){var b=function(a,b){var c=a.attr.slider.__parent__,d=c.attr.annotation.length-1,e=c.attr.annotation[d].x(),f=e+c.attr.annotation[d].width(),g=c.attr.annotation[d].y(),h=g-c.attr.annotation[d].height();a.redraw([e,f],[h,g],b)},d=function(a){var b=a.attr.slider.__parent__,c=a.xscale.domain(),d=a.yscale.domain(),e=b.attr.annotation.length-1,f=b.attr.annotation[e],g=c[c.length-1]-c[0],h=d[d.length-1]-d[0];f.x(c[0]),f.y(d[d.length-1]),f.width(g),f.height(h),a.attr.slider.__parent__.redraw()},e="auto"===c.attr.xrange?c.domain:c.attr.xrange,f="auto"===c.attr.yrange?c.range:c.attr.yrange;"string"==typeof e[0]&&(e=p.map(e,c.xmapper));var g=Math.abs(e[e.length-1]-e[0]),h=Math.abs(f[f.length-1]-f[0]),i=c.attr.slider.annotation().concat([{type:"rect",width:g,height:h,draggable:!0,x:e[0],y:f[1],style:{opacity:.25},hoveropacity:.2,events:{drag:function(){a.log("dragging slider"),b(c,!1)},dragend:function(){a.log("dragging slider"),b(c,!0)}}}]);c.attr.slider.annotation(i),c.attr.events.panold=c.attr.events.pan,c.attr.events.pan=function(){d(c),c.attr.events.panold()},c.attr.events.zoomold=c.attr.events.zoom,c.attr.events.zoom=function(){d(c),c.attr.events.zoomold()},a.render(c.attr.slider)}},this.hotdata=function(){a.log("optimizing plot data for visible window");var b=c.xscale.domain(),d=c.yscale.domain();return p.filter(c.data,function(a,e){if(c.attr.xwindow){var f=c.xmapper(c.attr.x(a,e));if(f<b[0]-c.xdelta||f>b[1]+c.xdelta)return!1}if(c.attr.ywindow){var g=c.ymapper(c.attr.y(a,e));if(g<d[0]-c.ydelta||g>d[1]+c.ydelta)return!1}return!0})},this.drawlegend=function(){a.log("drawing plot legend");var b=c.pallette.domain();c.attr.lorder.length===b.length&&(b=c.attr.lorder);var d="auto"===c.attr.width?parseInt(c.selection.style("width")):c.attr.width;"auto"===c.attr.height?parseInt(c.selection.style("height")):c.attr.height;d="inside"===c.attr.lposition?d-22:d;var e,f=c.attr.svg.append("g").attr("transform","translate("+(d-c.attr.margin.right)+","+c.attr.margin.top+")").selectAll(".legend").data(b).enter().append("g").attr("class","legend").attr("id",c.attr.id+"-legend").attr("transform",function(a,b){return"translate(0,"+(c.attr.lmargin.top+20*b)+")"});"square"===c.attr.lshape?e=f.append("rect").attr("class","selector").attr("x",5+c.attr.lmargin.left).attr("y",c.attr.lmargin.top).attr("width",18).attr("height",18).attr("rx",5).attr("ry",5).style("fill",c.pallette).style("fill-opacity",function(a){return p.contains(c.attr.toggled,a)?0:c.attr.opacity}):"circle"===c.attr.lshape&&(e=f.append("circle").attr("class","selector").attr("cx",20+c.attr.lmargin.left).attr("cy",8+c.attr.lmargin.top).attr("r",9).style("fill",c.pallette).style("fill-opacity",function(a){return p.contains(c.attr.toggled,a)?0:c.attr.opacity})),c.attr.toggle&&e.on("mouseover",function(a,b){d3.select(this).style("opacity",.75)}).on("mouseout",function(a,b){d3.select(this).style("opacity",1)}).on("click",function(a,b){0===parseFloat(d3.select(this).style("fill-opacity"))?(d3.select(this).style("fill-opacity",p.contains(c.attr.toggled,a)?c.attr.opacity:0),c.attr.svg.selectAll(".g_"+a).style("visibility","visible"),c.attr.toggled=p.without(c.attr.toggled,a)):(d3.select(this).style("fill-opacity",0),c.attr.svg.selectAll(".g_"+a).style("visibility","hidden"),c.attr.toggled=p.union(c.attr.toggled,[a]))}),f.append("text").attr("x",function(){if("inside"===c.attr.lposition)return c.attr.lmargin.left;if("outside"===c.attr.lposition){var a="square"===c.attr.lshape?0:7;return 27+c.attr.lmargin.left+a}}).attr("y",9+c.attr.lmargin.top).attr("dy",".35em").style("text-anchor",function(){return"inside"===c.attr.lposition?"end":"outside"===c.attr.lposition?"start":void 0}).text(function(a){return a})},this.drawglyphs=function(){a.log("drawing plot glyphs"),c.defs.append("symbol").attr("id","glyph-refresh").attr("viewBox","0 0 1024 1024").html(['<path d="M134.32 166.32c93.608-102.216 228.154-166.32 377.68-166.32 282.77 0 512 229.23 512 512h-96c0-229.75-186.25-416-416-416-123.020 0-233.542 53.418-309.696 138.306l149.696 149.694h-352v-352l134.32 134.32z"></path>','<path d="M96 512c0 229.75 186.25 416 416 416 123.020 0 233.542-53.418 309.694-138.306l-149.694-149.694h352v352l-134.32-134.32c-93.608 102.216-228.154 166.32-377.68 166.32-282.77 0-512-229.23-512-512h96z"></path>'].join("")),c.defs.append("symbol").attr("id","glyph-zoom").attr("viewBox","0 0 1024 1024").append("path").attr("d","M992.262 871.396l-242.552-206.294c-25.074-22.566-51.89-32.926-73.552-31.926 57.256-67.068 91.842-154.078 91.842-249.176 0-212.078-171.922-384-384-384-212.076 0-384 171.922-384 384s171.922 384 384 384c95.098 0 182.108-34.586 249.176-91.844-1 21.662 9.36 48.478 31.926 73.552l206.294 242.552c35.322 39.246 93.022 42.554 128.22 7.356s31.892-92.898-7.354-128.22zM384 640c-141.384 0-256-114.616-256-256s114.616-256 256-256 256 114.616 256 256-114.614 256-256 256z"),c.defs.append("symbol").attr("id","glyph-export").attr("viewBox","0 0 1024 1024").html(['<path d="M959.884 128c0.040 0.034 0.082 0.076 0.116 0.116v767.77c-0.034 0.040-0.076 0.082-0.116 0.116h-895.77c-0.040-0.034-0.082-0.076-0.114-0.116v-767.772c0.034-0.040 0.076-0.082 0.114-0.114h895.77zM960 64h-896c-35.2 0-64 28.8-64 64v768c0 35.2 28.8 64 64 64h896c35.2 0 64-28.8 64-64v-768c0-35.2-28.8-64-64-64v0z"></path>','<path d="M832 288c0 53.020-42.98 96-96 96s-96-42.98-96-96 42.98-96 96-96 96 42.98 96 96z"></path>','<path d="M896 832h-768v-128l224-384 256 320h64l224-192z"></path>'].join("")),c.defs.append("symbol").attr("id","glyph-pan").attr("viewBox","0 0 1024 1024").append("path").attr("d","M512 704l64-64v192h128l-192 192-192-192h128v-192zM512 321.984l-64 62.016v-192h-128l192-192 192 192h-128v192zM320 512l64 64h-192v128l-192-192 192-192v128h192zM702.016 512l-62.016-64h192v-128l192 192-192 192v-128h-192z"),c.defs.append("symbol").attr("id","glyph-annotate").attr("viewBox","0 0 1024 1024").append("path").attr("d","M864 0c88.364 0 160 71.634 160 160 0 36.020-11.91 69.258-32 96l-64 64-224-224 64-64c26.742-20.090 59.978-32 96-32zM64 736l-64 288 288-64 592-592-224-224-592 592zM715.578 363.578l-448 448-55.156-55.156 448-448 55.156 55.156z"),c.defs.append("symbol").attr("id","glyph-crosshairs").attr("viewBox","0 0 1029 1200").append("path").attr("d","M801.563 685.714h-72.991c-23.438 0-42.857-19.419-42.857-42.857v-85.714c0-23.438 19.419-42.857 42.857-42.857h72.991c-28.794-96.429-105.134-172.768-201.563-201.563v72.991c0 23.438-19.419 42.857-42.857 42.857h-85.714c-23.438 0-42.857-19.419-42.857-42.857v-72.991c-96.429 28.794-172.768 105.134-201.562 201.563h72.991c23.438 0 42.857 19.419 42.857 42.857v85.714c0 23.438-19.419 42.857-42.857 42.857h-72.991c28.794 96.429 105.134 172.768 201.563 201.563v-72.991c0-23.438 19.419-42.857 42.857-42.857h85.714c23.438 0 42.857 19.419 42.857 42.857v72.991c96.429-28.794 172.768-105.134 201.563-201.563zM1028.571 557.143v85.714c0 23.438-19.419 42.857-42.857 42.857h-95.759c-32.813 143.973-145.982 257.143-289.956 289.956v95.759c0 23.438-19.419 42.857-42.857 42.857h-85.714c-23.438 0-42.857-19.419-42.857-42.857v-95.759c-143.973-32.813-257.143-145.982-289.956-289.956h-95.759c-23.438 0-42.857-19.419-42.857-42.857v-85.714c0-23.438 19.419-42.857 42.857-42.857h95.759c32.813-143.973 145.982-257.143 289.956-289.956v-95.759c0-23.437 19.419-42.857 42.857-42.857h85.714c23.438 0 42.857 19.419 42.857 42.857v95.759c143.973 32.812 257.143 145.982 289.956 289.956h95.759c23.438 0 42.857 19.419 42.857 42.857z");var b=[];c.attr.annotatable&&b.push("annotate"),c.attr.zoomable&&b.push("pan","refresh"),0!=c.attr.crosshairs&&b.push("crosshairs"),c.attr.exportable&&b.push("export");var d=c.attr.svg.append("g").attr("transform","translate("+(c.innerwidth+c.attr.margin.left+5)+","+(c.innerheight-c.attr.margin.bottom-22*b.length+52)+")").selectAll(".glyphbox").data(b).enter().append("g").attr("class","glyphbox").attr("id",function(a){return a}).attr("transform",function(a,b){return"translate(0,"+25*b+")"}).on("mouseover",function(a){d3.select(this).style("opacity",.5),c.attr.tooltip&&c.attr.tooltip.html(a).style("visibility","visible").style("left",d3.event.clientX+10+"px").style("top",d3.event.clientY-10+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.clientX+10+"px").style("top",d3.event.clientY-10+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",1),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",function(b){switch(b){case"zoom":c.enabled.zoom=!c.enabled.zoom,this.enabled.pan=!c.enabled.pan,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.zoom?2:1).style("stroke",c.enabled.zoom?"black":"#555");break;case"pan":c.enabled.pan=!c.enabled.pan,c.enabled.zoom=!c.enabled.zoom,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.pan?2:1).style("stroke",c.enabled.pan?"black":"#555");break;case"crosshairs":c.enabled.crosshairs=!c.enabled.crosshairs,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.crosshairs?2:1).style("stroke",c.enabled.crosshairs?"black":"#555");break;case"refresh":c.xstack=[c.xstack[0]],c.ystack=[c.ystack[0]],c.redraw(c.xstack[0].domain(),c.ystack[0].domain(),!1),c.attr.events.zoom();break;case"annotate":c.enabled.annotate=!c.enabled.annotate,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.annotate?2:1).style("stroke",c.enabled.annotate?"black":"#555");break;case"export":c.attr.events.preexport(c.attr),a["export"](c.go,c.attr.plotname),c.attr.events.postexport(c.attr)}});"square"===c.attr.gshape?d.append("rect").attr("class","glyph").attr("width",22).attr("height",22).attr("rx",5).attr("ry",5).style("fill","transparent"):d.append("circle").attr("class","glyph").attr("cx",11).attr("cy",7).attr("r",11).style("fill","transparent"),d.append("svg").attr("width",22).attr("height",22).append("use").attr("x",("square"===c.attr.gshape,4)).attr("y","square"===c.attr.gshape?4:0).attr("height",14).attr("width",14).attr("xlink:href",function(a){return"#glyph-"+a})},this.enablezoom=function(){function b(a){return a.x>c.innerwidth||a.x<0||a.y>c.innerheight||a.y<0?!1:!0}a.log("enabling zoom events"),c.zoomdata={x:c.attr.margin.left,y:c.attr.margin.right},c.enabled.pan=!1,c.enabled.zoom=!0;var d=c.attr.svg.append("path").attr("class","viewbox").attr("transform","translate("+c.attr.margin.left+","+c.attr.margin.top+")"),e=d3.behavior.drag().on("dragstart",function(a){var b=n(c.attr.svg);c.zoomdata.x=b.x-c.attr.margin.left,c.zoomdata.y=b.y-c.attr.margin.top,c.enabled.pan&&c.attr.events.panstart(c.attr)}).on("dragend",function(a){d.attr("d","");var b=n(c.attr.svg);if(b.x=b.x-c.attr.margin.left,b.y=b.y-c.attr.margin.top,c.enabled.zoom){var e,f,g=!1,h=c.xstack.length;if(Math.abs(c.zoomdata.x-b.x)>10&&c.zoomdata.x>0){var i=c.xstack[h-1].domain(),j=c.xstack[h-1].range(),k=d3.scale.linear().domain(j).range(i);e=[k(c.zoomdata.x),k(b.x)].sort(function(a,b){return a-b}),e[0]=Math.max(e[0],i[0]),e[1]=Math.min(e[1],i[1]);d3.scale.linear().domain(e).range(j);g=!0}if(Math.abs(c.zoomdata.y-b.y)>10&&c.zoomdata.y<c.innerheight){var l=c.ystack[h-1].domain(),m=c.ystack[h-1].range(),o=d3.scale.linear().domain(m).range(l);f=[o(c.zoomdata.y),o(b.y)].sort(function(a,b){return a-b}),f[0]=Math.max(f[0],l[0]),f[1]=Math.min(f[1],l[1]);d3.scale.linear().domain(f).range(m);g=!0}g&&(c.redraw(e,f,!0),c.attr.events.zoom(c.attr))}else c.enabled.pan&&(c.xstack.push(c.xscale),c.ystack.push(c.yscale),c.attr.events.panend(c.attr))}).on("drag",function(a){var e=n(c.attr.svg);if(e.x=e.x-c.attr.margin.left,e.y=e.y-c.attr.margin.top,c.enabled.zoom)c.zoomdata.y>c.innerheight&&(e.y=0),c.zoomdata.x<0&&(e.x=c.innerwidth),d.attr("d",["M"+c.zoomdata.x+","+c.zoomdata.y,"L"+c.zoomdata.x+","+e.y,"L"+e.x+","+e.y,"L"+e.x+","+c.zoomdata.y,"Z"].join(""));else if(c.enabled.pan&&b(e)){d.attr("d","");var f=c.xstack.length,g=p.map(c.xscale.range(),function(a){return c.xmap(a-d3.event.dx)}),h=p.map(c.yscale.range(),function(a){return c.ymap(a-d3.event.dy)});c.xscale=d3.scale.linear().domain(g).range(c.xstack[f-1].range()),c.yscale=d3.scale.linear().domain(h).range(c.ystack[f-1].range()),c.redraw(g,h,!1),c.attr.events.pan(c.attr)}c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")});c.attr.svg.on("dblclick",function(){var a=c.xstack.length;a>1&&(c.xstack.pop(),c.ystack.pop(),a-=1),c.redraw(c.xstack[a-1].domain(),c.ystack[a-1].domain(),!1),c.attr.events.zoom()}).call(e).on("dblclick.zoom",null).on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),a.events.Shift.down=function(){d3.selectAll(".glyphbox#pan").selectAll(".glyph").style("stroke","black").style("stroke-width",2),p.each(Object.keys(a.plots),function(b){a.plots[b].enabled.pan=!0,a.plots[b].enabled.zoom=!1})},a.events.Shift.up=function(){d3.selectAll(".glyphbox#pan").selectAll(".glyph").style("stroke","#555").style("stroke-width",1),p.each(Object.keys(a.plots),function(b){a.plots[b].enabled.pan=!1,a.plots[b].enabled.zoom=!0})}},this.enableannotation=function(){a.log("enabling annotation events"),c.attr.svg.on("click",function(){if(c.enabled.annotate){var b=n(c.attr.svg);if(b.x>c.innerwidth+c.attr.margin.left||b.x<c.attr.margin.left||b.y>c.innerheight+c.attr.margin.top||b.y<c.attr.margin.top)return;var d={x:c.xmap(b.x-c.attr.margin.left),y:c.ymap(b.y-c.attr.margin.top)};for(var e in c.attr.annotation){var f=c.attr.annotation[e];if(Math.abs(c.xscale(f.x())-c.xscale(d.x))<20&&Math.abs(c.yscale(f.y())-c.yscale(d.y))<20)return}var g={};p.map(Object.keys(c.attr.annotatable),function(a){"add"===a||"function"!=typeof c.attr.annotatable[a]?g[a]=c.attr.annotatable[a]:g[a]=c.attr.annotatable[a](d)});var h=a.annotation(g).bind(c.go).x(d.x).y(d.y);g.x=d.x,g.y=d.y,c.attr.annotation.push(h),c.annotate(),h.events().add(g)}}),a.events.ShiftA.down=function(){d3.selectAll(".glyphbox#annotate").selectAll(".glyph").style("stroke","black").style("stroke-width",2),p.each(Object.keys(a.plots),function(b){a.plots[b].enabled.annotate=!0})},a.events.ShiftA.up=function(){d3.selectAll(".glyphbox#annotate").selectAll(".glyph").style("stroke","#ddd").style("stroke-width",1),p.each(Object.keys(a.plots),function(b){a.plots[b].enabled.annotate=!1})}},this.enablecrosshairs=function(){function b(a){return a.x>c.innerwidth||a.x<0||a.y>c.innerheight||a.y<0?!1:!0}function d(){e||(c.attr.crosshairx.style("opacity",0),c.attr.crosshairxtext.style("opacity",0)),f||p.map(Object.keys(c.attr.crosshairy),function(a){c.attr.crosshairy[a].style("opacity",0),c.attr.crosshairytext[a].style("opacity",0)})}a.log("enabling crosshairs events"),c.attr.crosshairs!==!1&&(c.attr.crosshairs="mouse"),c.enabled.crosshairs=!1;var e="string"==typeof c.data[0].x;("bar"===c.type||"histogram"===c.type)&&(e=!0);var f="string"==typeof c.data[0].y;if(c.crossregion=c.attr.svg.append("g").attr("class","crosshair"),!e){if(c.attr.crosshairx=c.crossregion.append("line").attr("x1",50).attr("y1",c.attr.margin.top).attr("x2",50).attr("y2",c.attr.margin.top+c.innerheight).attr("stroke","#bbb").style("opacity",0).style("pointer-events","none"),"start"==c.attr.crossposition)var g=c.innerheight+c.attr.margin.top-5,h="start";else if("end"==c.attr.crossposition)var g=c.attr.margin.top+10,h="start";else if("middle"==c.attr.crossposition)var g=c.attr.margin.top+10,h="end";c.attr.crosshairxtext=c.crossregion.append("text").attr("x",100).attr("y",g).attr("text-anchor",h).style("opacity",0).text("")}if(!f)if(c.attr.crosshairy={},c.attr.crosshairytext={},"mouse"==c.attr.crosshairs){if(c.attr.crosshairy.mouse=c.crossregion.append("line").attr("x1",c.attr.margin.left).attr("y1",50).attr("x2",c.attr.margin.left+c.innerwidth).attr("y2",50).attr("stroke","#bbb").style("opacity",0).style("pointer-events","none"),"start"==c.attr.crossposition)var i=c.attr.margin.left+5,j="start";else if("end"==c.attr.crossposition)var i=c.attr.margin.left+c.innerwidth,j="end";else if("middle"==c.attr.crossposition)var i=c.attr.margin.left+c.innerwidth,j="start";c.attr.crosshairytext.mouse=c.crossregion.append("text").attr("x",i).attr("y",100).attr("text-anchor",j).style("opacity",0).text("")}else("bar"===c.type||"histogram"===c.type||"scatter"===c.type)&&(e=!0,f=!0);c.attr.svg.on("mousemove",function(a){var g=n(c.attr.svg);if(g.x=g.x-c.attr.margin.left,g.y=g.y-c.attr.margin.top,b(g)&&c.enabled.crosshairs){var h=g.x+c.attr.margin.left,i=g.y+c.attr.margin.top;if(!e){var j=c.attr.xcrossformat(c.xmap(g.x));c.attr.crosshairx.style("opacity",.75).attr("x1",h).attr("x2",h),c.attr.crosshairxtext.style("opacity",.75).attr("x",h+3).text(j),"middle"==c.attr.crossposition&&c.attr.crosshairxtext.attr("x",h-5).attr("y",i-5).text("X: "+j)}if(!f&&"mouse"==c.attr.crosshairs){var k=c.attr.ycrossformat(c.ymap(g.y));c.attr.crosshairy.mouse.style("opacity",.75).attr("y1",i).attr("y2",i),c.attr.crosshairytext.mouse.style("opacity",.75).attr("y",i-5).text(k),"middle"===c.attr.crossposition&&c.attr.crosshairytext.mouse.attr("x",h+5).attr("y",i-5).text("Y: "+k)}}else d()}).on("mouseout",function(a){d()}),a.events.ShiftX.down=function(){d3.selectAll(".glyphbox#crosshairs").selectAll(".glyph").style("stroke","black").style("stroke-width",2),p.each(Object.keys(a.plots),function(b){a.plots[b].enabled.crosshairs=!0})},a.events.ShiftX.up=function(){d3.selectAll(".glyphbox#crosshairs").selectAll(".glyph").style("stroke","#555").style("stroke-width",1),p.each(Object.keys(a.plots),function(b){a.plots[b].enabled.crosshairs=!1})}},this.attr=extend({id:a.uuid(),plotname:"quorra-plot",type:"quorra-plot",width:"auto",height:"auto",margin:{top:20,bottom:40,left:40,right:65},svg:null,bind:"body",data:[],x:function(a,b){return a.x},y:function(a,b){return a.y},group:function(a,b){return"undefined"==typeof a.group?"data":a.group},label:function(a,b){return"undefined"==typeof a.label?b:a.label},transform:function(a){return a},color:"auto",xrange:"auto",yrange:"auto",zoomable:!1,annotatable:!1,exportable:!1,selectable:!1,crosshairs:!1,events:{zoom:function(){a.log("zoom event")},pan:function(){a.log("pan event")},panstart:function(){a.log("pan start event")},panend:function(){a.log("pan end event")},preexport:function(){a.log("pre export event")},postexport:function(){a.log("post export event")},click:function(b,c){a.log("clicked plot element")}},grid:!1,xticks:"auto",yticks:"auto",xaxis:"outside",yaxis:"outside",xformat:function(a){return a},xcrossformat:d3.format(".2f"),yformat:function(a){return a},ycrossformat:d3.format(".2f"),crossposition:"end",xorient:"bottom",yorient:"left",xlabel:"",ylabel:"",xorder:[],yorder:[],xwidnow:!0,ywindow:!1,labelposition:"middle",labelpadding:{x:0,y:0},opacity:1,hovercolor:!1,legend:!0,lmargin:{top:0,bottom:0,left:0,right:0},lposition:"outside",lshape:"square",lorder:[],toggle:!1,toggled:[],selected:[],tooltip:!0,glyphs:!0,gshape:"circle",annotation:[],slider:null},b),parameterize(c.attr,c.go),c.go.__parent__=c,c.go.annotation=function(b){return arguments.length?(c.attr.annotation=p.map(b,function(b){return"function"!=typeof b&&(b=a.annotation(b).bind(c.go)),b}),c.go):p.map(c.attr.annotation,function(a){return a.__parent__.attr})},c.go.annotate=function(a){return"undefined"==typeof c.attr.annotation?c.attr.annotation=[a]:c.attr.annotation.push(a),c.go},this.go}function c(a){var c=this;return"undefined"==typeof a&&(a={}),b.call(this,extend({"class":"quorra-bar",layout:"stacked"},a)),this.type="bar",this.plot=function(){c.plotdata=c.hotdata();var a=[],b=c.pallette.domain();"string"==typeof c.plotdata[0].x&&(c.plotdata=c.plotdata.sort(function(a,b){return a.x>b.x}));for(var d in b){var e=p.filter(c.plotdata,function(a){return c.attr.group(a)==b[d]});e=p.map(e,function(a){return a.layer=d,a}),a.push(p.filter(e,function(a){return c.attr.group(a)==b[d]}))}for(var f=p.map(a[0],function(a){return 0}),g=0;g<a.length;g++)a[g]=p.map(a[g],function(a,b){return a.y0=f[b],f[b]=f[b]+a.y,a});var h=c.plotarea.selectAll(".layer").remove().data(a).enter().append("g").attr("class","layer");h.selectAll("rect").remove().data(function(a){return a}).enter().append("rect").attr("class",function(a,b){return"bar g_"+c.attr.group(a)}).attr("x",function(b,d){if(a[0].length>1){var e="string"==typeof c.attr.x(b,d)?.5:0;if("stacked"===c.attr.layout)return c.xscale(c.xmapper(c.attr.x(b,d))-e);var f=Math.abs(c.xscale(c.xmapper(c.attr.x(a[0][1])))-c.xscale(c.xmapper(c.attr.x(a[0][0]))));return c.xscale(c.xmapper(c.attr.x(b,d))-e)+c.pallette.range().indexOf(c.pallette(c.attr.group(b)))*(f/c.pallette.domain().length)}var g=c.xscale.range();return g[1]-g[0]-2}).attr("y",function(a,b){return"stacked"==c.attr.layout?c.yscale(c.ymapper(a.y0+a.y)):c.yscale(c.ymapper(a.y))}).attr("height",function(a,b){return"stacked"==c.attr.layout?c.yscale(c.ymapper(a.y0))-c.yscale(c.ymapper(a.y0+a.y)):p.max([c.innerheight-c.yscale(c.ymapper(a.y)),0])}).attr("width",function(b){if(a[0].length>1){var d=Math.abs(c.xscale(c.xmapper(c.attr.x(a[0][1])))-c.xscale(c.xmapper(c.attr.x(a[0][0]))));return"stacked"===c.attr.layout?d-2:d/c.pallette.domain().length-2}var e=c.xscale.range();return e[1]-e[0]-2}).attr("fill",function(a,b){return c.pallette(c.attr.group(a))}).style("opacity",c.attr.opacity).style("visibility",function(a){return p.contains(c.attr.toggled,c.attr.group(a))?"hidden":"visible"}).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),c.attr.tooltip&&c.attr.tooltip.html(a.label).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",c.attr.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",function(a,b){c.attr.events.click(a,b)})},this.go}function d(a){var b=this;return"undefined"==typeof a&&(a={}),g.call(this,extend({"class":"quorra-density",resolution:10},a)),this.type="density",b.attr.transform=function(a){var c=d3.format(".04f"),d=p.map(a,function(a){return a.x}),e=p.min(d),f=p.max(d),g=l(m(9),d3.scale.linear().domain([e,f]).ticks(b.attr.resolution)),h=p.uniquesort(a,b.attr.group),i=[];for(var j in h){var k=p.filter(a,function(a){return b.attr.group(a)==h[j]}),n=g(p.map(k,function(a){return a.x}));n=p.map(n,function(a){return{x:a.x,y:a.y,group:h[j],label:c(a.y)}}),i=i.concat(n)}return i},this.go}function e(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-graph",nodes:[],links:[],charge:-100,distance:60,nwformat:function(a){return a.size+5},ewformat:function(a){return a.weight+1},edgecolor:"auto"},c)),this.type="graph",this.axes=function(){},this.drawlegend=function(){},this.plot=function(){var a="auto"==d.attr.width?parseInt(d.selection.style("width")):d.attr.width,b="auto"==d.attr.height?parseInt(d.selection.style("height")):d.attr.height;if(a=a-d.attr.margin.left-d.attr.margin.right,b=b-d.attr.margin.top-d.attr.margin.bottom,d.plotdata={nodes:[],links:[]},0==d.attr.nodes.length){var c={};d.attr.links.forEach(function(a){c[a.source]={id:a.source},c[a.target]={id:a.target}}),d.plotdata.nodes=d3.values(c)}else d.plotdata.nodes=p.map(d.attr.nodes,function(a){var b=p.clone(a);return b.size=b.weight,b});var e=[],f=[],g={};d.plotdata.nodes=p.map(d.plotdata.nodes,function(a,b){return g[a.id]=b,void 0===a.group&&(a.group="node"),void 0===a.size&&(a.size=1),-1===e.indexOf(a.group)&&e.push(a.group),a}),d.plotdata.links=p.map(d.attr.links,function(a){var b=p.clone(a);return b.source=g[a.source],b.target=g[a.target],void 0===b.group&&(b.group="edge"),void 0===b.weight&&(b.weight=1),-1===f.indexOf(b.edgegroups)&&f.push(b.edgegroups),b}),d.pallette="auto"===d.attr.color?d3.scale.category10():d3.scale.ordinal().range(d.attr.color),d.pallette=d.pallette.domain(e),d.edgepallette="auto"===d.attr.edgecolor?d3.scale.category10():d3.scale.ordinal().range(d.attr.edgecolor),d.edgepallette=d.edgepallette.domain(f);var h=d3.layout.force().nodes(d.plotdata.nodes).links(d.plotdata.links).size([a,b]).linkDistance(d.attr.distance).charge(d.attr.charge).on("tick",function(){i.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),j.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}).start();h.drag().on("dragstart",function(a){d3.event.sourceEvent.stopPropagation()});var i=d.plotregion.selectAll(".link").data(h.links()).enter().append("line").attr("stroke",function(a){return"edge"===a.group?"#ddd":d.edgepallette(a.group)}).attr("stroke-width",d.attr.ewformat).attr("class","link"),j=d.plotregion.selectAll(".node").data(h.nodes()).enter().append("g").attr("class","node").attr("fill",function(a){return d.pallette(a.group)}).on("mouseover",function(a){if(d3.select(this).select("circle").transition().duration(250).attr("r",d.attr.nwformat(a)+5),d.attr.tooltip){var b=a.label?a.label:a.id;d.attr.tooltip.html(b).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a){d3.select(this).select("circle").transition().duration(250).attr("r",d.attr.nwformat(a)),
d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden")}).call(h.drag);j.append("circle").attr("r",d.attr.nwformat)},this.enablezoom=function(){d.attr.svg.call(d3.behavior.zoom().on("zoom",function(){d.plotregion.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}))},this.drawglyphs=function(){},this.enablecrosshairs=function(){a.log("crosshairs not supported on pie chart")},this.go}function f(a){var b=this;return"undefined"==typeof a&&(a={}),c.call(this,extend({"class":"quorra-histogram",bins:10,display:"counts"},a)),this.type="histogram",b.attr.transform=function(a){if("percent"==b.attr.display)var c=d3.format("0.02%");else if("counts"==b.attr.display)var c=d3.format(".0f");else if("fraction"==b.attr.display)var c=d3.format(".02f");var d=d3.layout.histogram().frequency(!1).bins(d3.scale.linear().ticks(b.attr.bins)),e=p.uniquesort(a,b.attr.group),f=[];for(var g in e){var h=p.filter(a,function(a){return b.attr.group(a)==e[g]}),i=d(p.map(h,function(a){return a.x}));i=p.map(i,function(a){return"counts"==b.attr.display?a.y=a.y*h.length:"percent"==b.attr.display&&(a.y=a.y),{x:a.x,y:a.y,group:e[g],label:c(a.y)}}),f=f.concat(i)}return f},this.go}function g(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-line",points:0,size:3,layout:"line",interpolate:"linear"},c)),this.type="line",this.plot=function(){a.log("drawing plot data");var b=d3.svg.line().x(function(a,b){return d.xscale(d.xmapper(d.attr.x(a,b)))}).y(function(a,b){return d.yscale(d.ymapper(d.attr.y(a,b)))}).interpolate(d.attr.interpolate);d.plotdata=d.hotdata();var c=d.pallette.domain();for(var e in c){var f=p.filter(d.plotdata,function(a){return d.attr.group(a)==c[e]});0!=f.length&&d.plotarea.append("path").datum(f).attr("class",function(a,b){return"line g_"+d.attr.group(a[0])}).attr("d",function(a){var c=b(a);return"line"===d.attr.layout?c:"area"===d.attr.layout?[c,"L"+d.xscale(d.xmapper(d.domain[d.domain.length-1]))+","+d.yscale(d.ymapper(d.range[0])),"L"+d.xscale(d.xmapper(d.domain[0]))+","+d.yscale(d.ymapper(d.range[0])),"Z"].join(""):void 0}).style("fill",function(a){return"line"===d.attr.layout?"none":"area"===d.attr.layout?d.pallette(d.attr.group(a[0])):void 0}).style("stroke",function(a,b){return p.contains(d.attr.selected,d.attr.group(a[0],b))?d.attr.hovercolor!==!1?d.attr.hovercolor:"firebrick":d.pallette(d.attr.group(a[0]))}).style("stroke-width",d.attr.size).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a[0],b))?"hidden":"visible"}).on("mouseover",function(a,b){p.contains(d.attr.selected,d.attr.group(a[0],b))||(d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a[0])).style("fill",d.attr.hovercolor),d.plotarea.selectAll(".line.g_"+d.attr.group(a[0])).style("stroke",d.attr.hovercolor),null!==d.attr.slider&&(d.attr.slider.__parent__.plotarea.selectAll(".dot.g_"+d.attr.group(a[0])).style("fill",d.attr.hovercolor),d.attr.slider.__parent__.plotarea.selectAll(".line.g_"+d.attr.group(a[0])).style("stroke",d.attr.hovercolor))):(d.plotarea.selectAll(".g_"+d.attr.group(a[0])).style("opacity",.25),null!==d.attr.slider&&d.attr.slider.__parent__.selectAll(".g_"+d.attr.group(a[0])).style("opacity",.25)),d.attr.tooltip&&d.attr.tooltip.html(d.attr.group(a[0])).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px"))}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a){d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a[0])).style("fill",d.pallette(d.attr.group(a[0]))),d.plotarea.selectAll(".line.g_"+d.attr.group(a[0])).style("stroke",d.pallette(d.attr.group(a[0]))),null!==d.attr.slider&&(d.attr.slider.__parent__.plotarea.selectAll(".dot.g_"+d.attr.group(a[0])).style("fill",d.pallette(d.attr.group(a[0]))),d.attr.slider.__parent__.plotarea.selectAll(".line.g_"+d.attr.group(a[0])).style("stroke",d.pallette(d.attr.group(a[0]))))):(d.plotarea.selectAll(".g_"+d.attr.group(a[0])).style("opacity",d.attr.opacity),null!==d.attr.slider&&d.attr.slider.__parent__.selectAll(".g_"+d.attr.group(a[0])).style("opacity",d.attr.opacity)),d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden")}).on("click",function(a,b){d.attr.selectable!==!1&&(d.attr.selected=selectmerge(d.attr.selected,d.attr.group(a[0]),d.attr.selectable),d.redraw(d.xscale.domain(),d.yscale.domain(),!1)),d.attr.slider&&(d.attr.slider.__parent__.attr.selected=d.attr.selected,d.attr.slider.__parent__.redraw()),d.attr.events.click(a,b)})}d.attr.points>0&&d.plotarea.selectAll(".dot").remove().data(d.plotdata).enter().append("circle").attr("class",function(a,b){return"dot g_"+d.attr.group(a)}).attr("r",d.attr.points).attr("cx",function(a,b){return d.xscale(d.xmapper(d.attr.x(a,b)))}).attr("cy",function(a,b){return d.yscale(d.ymapper(d.attr.y(a,b)))}).style("fill",function(a,b){return p.contains(d.attr.selected,d.attr.group(a,b))?d.attr.hovercolor!==!1?d.attr.hovercolor:"firebrick":d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),d.attr.tooltip&&d.attr.tooltip.html(d.attr.label(a,b)).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",d.attr.opacity),d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden")}).on("click",function(a,b){d.attr.selectable!==!1&&(d.attr.selected=selectmerge(d.attr.selected,d.attr.group(a),d.attr.selectable),d.redraw(d.xscale.domain(),d.yscale.domain(),!1)),d.attr.slider&&(d.attr.slider.__parent__.attr.selected=d.attr.selected,d.attr.slider.__parent__.redraw()),d.attr.events.click(a,b)})},this.go}function h(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-multiline",points:0,size:3,layout:"line",interpolate:"linear",margin:{top:30,bottom:20,left:0,right:70},yranges:{}},c)),this.type="multiline",this.axes=function(){a.log("redrawing axes");var b="auto"===d.attr.xrange?d.domain:d.attr.xrange;"auto"===d.attr.yrange?d.range:d.attr.yrange;d.xord=d3.scale.ordinal().domain(d.domain).range(p.range(d.domain.length)),d.xordrev=d3.scale.ordinal().domain(d.xord.range()).range(d.xord.domain()),d.xmapper=function(a){return d.xord(a)},"string"==typeof b[0]&&(b=p.map(b,d.xmapper),b[0]=b[0]-.5,b[b.length-1]=b[b.length-1]+.5),d.xscale=d3.scale.linear().domain([b[0],b[b.length-1]]).range([0,d.innerwidth]),d.xaxis=d3.svg.axis().scale(d.xscale).orient("top"),"auto"!==d.attr.xticks&&(d.xaxis=d.xaxis.ticks(d.attr.xticks)),d.xaxis=d.xaxis.tickFormat(d.attr.xformat),"string"==typeof b[0]&&(b=p.map(b,d.xord)),d.xaxis=d.xaxis.tickValues(p.range(Math.ceil(b[0]),Math.floor(b[b.length-1])+1)).tickFormat(function(a){var b=p.map(d.domain,d.xmapper);return a>=b[0]&&a<=b[b.length-1]?d.attr.xformat(d.xordrev(a)):""}).tickSize(0).tickPadding(15),d.plotregion.append("g").attr("class","x axis").call(d.xaxis),d.plotregion.selectAll(".x.axis .domain").remove(),d.yscale=d3.scale.linear().domain([0,1]).range([d.innerheight,0]),d.yscales=[],d.yaxes=[];for(var c=(d.xscale(1)-d.xscale(0),0);c<d.domain.length;c++){var e=p.filter(d.data,function(a){return a.x===d.domain[c]});if(e=p.map(e,function(a){return a.y}),void 0!==d.attr.yranges[d.domain[c]])var b=d.attr.yranges[d.domain[c]];else var b=[p.min(e),p.max(e)];var f=d3.scale.linear().domain(b).range([0,1]);d.yscales.push(f);var g=d3.scale.linear().domain(b).range(d.yscale.range()).nice(),h=d3.svg.axis().scale(g).orient("left");"auto"!==d.attr.yticks&&(h=h.ticks(d.attr.yticks)),h=h.tickFormat(d.attr.yformat),d.yaxes.push(h),d.plotregion.append("g").attr("transform","translate("+d.xscale(c)+",0)").attr("class","y axis").call(h)}},this.plot=function(){a.log("drawing plot data"),d.plotdata=d.data;var b=d.pallette.domain();for(var c in b){var e=d3.svg.line().x(function(a,b){return d.xscale(d.xmapper(d.attr.x(a,b)))}).y(function(a,b){return d.yscale(d.yscales[d.xord(a.x)](a.y))}).interpolate(d.attr.interpolate),f=p.filter(d.plotdata,function(a){return d.attr.group(a)===b[c]});0!=f.length&&(f=f.sort(function(a,b){return d.domain.indexOf(a.x)-d.domain.indexOf(b.x)}),d.plotarea.append("path").datum(f).attr("class",function(a,b){return"line g_"+d.attr.group(a[0])}).attr("d",function(a){var b=e(a);return"line"===d.attr.layout?b:"area"===d.attr.layout?[b,"L"+d.xscale(d.xmapper(d.domain[d.domain.length-1]))+","+d.yscale(0),"L"+d.xscale(d.xmapper(d.domain[0]))+","+d.yscale(1),"Z"].join(""):void 0}).style("fill",function(a){return"line"===d.attr.layout?"none":"area"===d.attr.layout?d.pallette(d.attr.group(a[0])):void 0}).style("stroke",function(a,b){return p.contains(d.attr.selected,d.attr.group(a[0]))?d.attr.hovercolor!==!1?d.attr.hovercolor:"firebrick":d.pallette(d.attr.group(a[0]))}).style("stroke-width",d.attr.size).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a[0]))?"hidden":"visible"}).on("mouseover",function(a,b){d.attr.tooltip&&d.attr.tooltip.html(d.attr.group(a[0])).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px"),p.contains(d.attr.selected,d.attr.group(a[0]))||(d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a[0])).style("fill",d.attr.hovercolor),d.plotarea.selectAll(".line.g_"+d.attr.group(a[0])).style("stroke",d.attr.hovercolor)):d.plotarea.selectAll(".g_"+d.attr.group(a[0])).style("opacity",.25))}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a,b){d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden"),p.contains(d.attr.selected,d.attr.group(a[0],b))||(d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a[0])).style("fill",d.pallette(d.attr.group(a[0]))),d.plotarea.selectAll(".line.g_"+d.attr.group(a[0])).style("stroke",d.pallette(d.attr.group(a[0])))):d.plotarea.selectAll(".g_"+d.attr.group(a[0])).style("opacity",d.attr.opacity))}).on("click",function(a,b){d.attr.selectable!==!1&&(d.attr.selected=selectmerge(d.attr.selected,d.attr.group(a[0]),d.attr.selectable),d.redraw(d.xscale.domain(),d.yscale.domain(),!1)),d.attr.slider&&(d.attr.slider.__parent__.attr.selected=d.attr.selected,d.attr.slider.__parent__.redraw()),d.attr.events.click(a,b)}))}d.attr.points>0&&d.plotarea.selectAll(".dot").remove().data(d.plotdata).enter().append("circle").attr("class",function(a,b){return"dot g_"+d.attr.group(a)}).attr("r",d.attr.points).attr("cx",function(a,b){return d.xscale(d.xmapper(d.attr.x(a,b)))}).attr("cy",function(a,b){return d.yscale(d.yscales[d.xord(a.x)](a.y))}).style("fill",function(a,b){return p.contains(d.attr.selected,d.attr.group(a,b))?d.attr.hovercolor!==!1?d.attr.hovercolor:"firebrick":d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}).on("mouseover",function(a,b){d.attr.tooltip&&d.attr.tooltip.html(d.attr.label(a,b)).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px"),p.contains(d.attr.selected,d.attr.group(a,b))||(d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a)).style("fill",d.attr.hovercolor),d.plotarea.selectAll(".line.g_"+d.attr.group(a)).style("stroke",d.attr.hovercolor)):d.plotarea.selectAll(".g_"+d.attr.group(a)).style("opacity",.25))}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a,b){d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden"),p.contains(d.attr.selected,d.attr.group(a,b))||(d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a)).style("fill",d.pallette(d.attr.group(a,b))),d.plotarea.selectAll(".line.g_"+d.attr.group(a)).style("stroke",d.pallette(d.attr.group(a,b)))):d.plotarea.selectAll(".g_"+d.attr.group(a)).style("opacity",d.attr.opacity))}).on("click",function(a,b){d.attr.selectable!==!1&&(d.attr.selected=selectmerge(d.attr.selected,d.attr.group(a),d.attr.selectable),d.redraw(d.xscale.domain(),d.yscale.domain(),!1)),d.attr.slider&&(d.attr.slider.__parent__.attr.selected=d.attr.selected,d.attr.slider.__parent__.redraw()),d.attr.events.click(a,b)})},this.enablecrosshairs=function(){a.log("crosshairs not supported on multiline plot")},this.go}function i(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-pie",aggregate:function(a){return a[0]},radius:"auto",inner:"auto"},c)),this.type="pie",this.axes=function(){},this.plot=function(){var a="auto"==d.attr.width?parseInt(d.selection.style("width")):d.attr.width,b="auto"==d.attr.height?parseInt(d.selection.style("height")):d.attr.height;a=a-d.attr.margin.left-d.attr.margin.right,b=b-d.attr.margin.top-d.attr.margin.bottom;var c="auto"==d.attr.radius?Math.min(a,b)/2:d.attr.radius,e="auto"==d.attr.inner?0:d.attr.inner,f=[],g=d.pallette.domain();for(var h in g){var i=p.filter(d.data,function(a){return d.attr.group(a)==g[h]});f.push({x:d.attr.aggregate(p.map(i,function(a){return a.x})),group:g[h],label:i.length<=1?g[h]:i.length+" "+g[h]})}var j=d3.svg.arc().outerRadius(c).innerRadius(e),k=d3.layout.pie().sort(null).value(function(a){return a.x}),l=d.plotregion.attr("transform","translate("+d.innerwidth/2+","+d.innerheight/2+")").selectAll(".arc").data(k(f)).enter().append("g").attr("class",function(a){return"arc g_"+a.data.group}).style("visibility",function(a){return p.contains(d.attr.toggled,d.attr.group(a.data))?"hidden":"visible"});l.append("path").attr("d",j).style("fill",function(a,b){return d.pallette(d.attr.group(a.data,b))}).style("opacity",d.attr.opacity).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),d.attr.tooltip&&d.attr.tooltip.html(d.attr.label(a.data,b)).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",d.attr.opacity),d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden")}).on("click",d.attr.events.click)},this.enablecrosshairs=function(){a.log("crosshairs not supported on multiline plot")},this.go}function j(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-scatter",lm:!1,xdensity:!1,ydensity:!1,xjitter:0,yjitter:0,size:5,line:!1,lineinterpolate:"linear",linelayout:"line",linesize:3},c)),this.type="scatter",this.plot=function(){d.xscale.domain();if(d.plotdata=p.map(d.hotdata(),function(b,c){var e=extend({},b);return e.x=(a.pseudorandom(c)-.5)*d.attr.xjitter+d.xscale(d.xmapper(d.attr.x(b,c))),e.y=(a.pseudorandom(c)-.5)*d.attr.yjitter+d.yscale(d.ymapper(d.attr.y(b,c))),e}),d.attr.line!==!1){var b=d3.svg.line().x(function(a,b){return a.x}).y(function(a,b){return a.y}).interpolate(d.attr.lineinterpolate),c=d.pallette.domain();for(var e in c){var f=p.filter(d.plotdata,function(a,b){return d.attr.group(a)==c[e]});0!=f.length&&d.plotarea.append("path").datum(f).attr("class",function(a,b){return"line g_"+d.attr.group(a[0])}).attr("d",function(a){var c=b(a);return"line"===d.attr.linelayout?c:"area"===d.attr.linelayout?[c,"L"+d.xscale(d.xmapper(d.domain[d.domain.length-1]))+","+d.yscale(d.ymapper(d.range[0])),"L"+d.xscale(d.xmapper(d.domain[0]))+","+d.yscale(d.ymapper(d.range[0])),"Z"].join(""):void 0}).style("fill",function(a){return"line"===d.attr.linelayout?"none":"area"===d.attr.linelayout?d.pallette(d.attr.group(a[0])):void 0}).style("stroke",function(a,b){return p.contains(d.attr.selected,d.attr.group(a[0]))?d.attr.hovercolor!==!1?d.attr.hovercolor:"firebrick":d.pallette(d.attr.group(a[0]))}).style("stroke-width",d.attr.linesize).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.selected,d.attr.group(a[0]))?"visible":"hover"===d.attr.line?"hidden":d.attr.line?p.contains(d.attr.toggled,d.attr.group(a[0]))?"hidden":"visible":void 0}).on("click",function(a,b){d.attr.selectable!==!1&&(d.attr.selected=selectmerge(d.attr.selected,d.attr.group(a[0]),d.attr.selectable),d.redraw(d.xscale.domain(),d.yscale.domain(),!1)),d.attr.slider&&(d.attr.slider.__parent__.attr.selected=d.attr.selected,d.attr.slider.__parent__.redraw()),d.attr.events.click(a,b)})}}d.plotarea.selectAll(".dot").remove().data(d.plotdata).enter().append("circle").attr("class",function(a,b){return"dot g_"+d.attr.group(a,b)}).attr("r",d.attr.size).attr("cx",function(a,b){return a.x}).attr("cy",function(a,b){return a.y}).style("fill",function(a,b){return p.contains(d.attr.selected,d.attr.group(a,b))?d.attr.hovercolor!==!1?d.attr.hovercolor:"firebrick":d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}).attr("clip-path","url(#clip)").on("mouseover",function(a,b){d.attr.tooltip&&d.attr.tooltip.html(d.attr.label(a,b)).style("visibility","visible").style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px"),p.contains(d.attr.selected,d.attr.group(a,b))||("hover"===d.attr.line&&d.plotarea.selectAll(".line.g_"+d.attr.group(a,b)).style("visibility","visible"),d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a,b)).style("fill",d.attr.hovercolor),d.plotarea.selectAll(".line.g_"+d.attr.group(a,b)).style("stroke",d.attr.hovercolor),null!==d.attr.slider&&(d.attr.slider.__parent__.plotarea.selectAll(".dot.g_"+d.attr.group(a,b)).style("fill",d.attr.hovercolor),d.attr.slider.__parent__.plotarea.selectAll(".line.g_"+d.attr.group(a,b)).style("stroke",d.attr.hovercolor))):(d3.select(this).style("opacity",.25),null!==d.attr.slider&&d.attr.slider.__parent__.plotarea.selectAll(".g_"+d.attr.group(a,b)).style("opacity",.25)))}).on("mousemove",function(a,b){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.clientX+5+"px").style("top",d3.event.clientY-20+"px")}).on("mouseout",function(a,b){d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden"),p.contains(d.attr.selected,d.attr.group(a,b))||("hover"===d.attr.line&&d.plotarea.selectAll(".line.g_"+d.attr.group(a,b)).style("visibility","hidden"),d.attr.hovercolor!==!1?(d.plotarea.selectAll(".dot.g_"+d.attr.group(a,b)).style("fill",d.pallette(d.attr.group(a,b))),d.plotarea.selectAll(".line.g_"+d.attr.group(a,b)).style("stroke",d.pallette(d.attr.group(a,b))),null!==d.attr.slider&&(d.attr.slider.__parent__.plotarea.selectAll(".dot.g_"+d.attr.group(a,b)).style("fill",d.pallette(d.attr.group(a,b))),d.attr.slider.__parent__.plotarea.selectAll(".line.g_"+d.attr.group(a,b)).style("stroke",d.pallette(d.attr.group(a,b))))):(d3.select(this).style("opacity",d.attr.opacity),null!==d.attr.slider&&d.attr.slider.__parent__.plotarea.selectAll(".g_"+d.attr.group(a,b)).style("opacity",d.attr.opacity)))}).on("click",function(a,b){d.attr.selectable!==!1&&(d.attr.selected=selectmerge(d.attr.selected,d.attr.group(a,b),d.attr.selectable),d.redraw(d.xscale.domain(),d.yscale.domain(),!1),d.attr.slider&&(d.attr.slider.__parent__.attr.selected=d.attr.selected,d.attr.slider.__parent__.redraw())),d.attr.events.click(a,b)}),d.attr.xdensity&&d.plotarea.selectAll(".xtick").remove().data(d.plotdata).enter().append("line").attr("clip-path","url(#clip)").attr("class",function(a,b){return"xtick g_"+d.attr.group(a,b)}).attr("x1",function(a,b){return d.xscale(d.xmapper(d.attr.x(a,b)))}).attr("x2",function(a,b){return d.xscale(d.xmapper(d.attr.x(a,b)))}).attr("y1",function(a,b){return d.innerheight}).attr("y2",function(a,b){return d.innerheight-10}).attr("stroke",function(a,b){return d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}),d.attr.ydensity&&d.plotarea.selectAll(".ytick").remove().data(d.plotdata).enter().append("line").attr("clip-path","url(#clip)").attr("class",function(a,b){return"ytick g_"+d.attr.group(a,b)}).attr("x1",function(a,b){return 0}).attr("x2",function(a,b){return 10}).attr("y1",function(a,b){return d.yscale(d.ymapper(d.attr.y(a,b)))}).attr("y2",function(a,b){return d.yscale(d.ymapper(d.attr.y(a,b)))}).attr("stroke",function(a,b){return d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return p.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}),0!=d.attr.lm&&a.error("Not yet implemented!")},this.go}function k(b){a.log("instantiating annotation object"),"undefined"==typeof b&&(b={}),"undefined"==typeof plot&&(plot="body");var c=this;return this.go=function(){a.log("running annotation generator function"),d3.selectAll("div.annotation-tooltip#"+c.attr.id+"-tooltip").remove(),1==c.attr.tooltip&&(c.attr.tooltip=d3.select("body").append("div").attr("class","annotation-tooltip").attr("id",+c.attr.id+"-tooltip").style("position","fixed").style("visibility","hidden").style("zindex",999)),c.plot.plotarea.selectAll(".annotation#"+c.attr.id).remove();var b=null===c.attr.group?"annotation "+c.attr.type:"annotation "+c.attr.type+" g_"+c.attr.group,d=c.plot.plotarea.append("g").attr("id",c.attr.id).attr("class",b).style("visibility",function(){return p.contains(c.plot.attr.toggled,c.plot.attr.group(c.attr))?"none":"visible"}).style("opacity",c.attr.style.opacity).on("mouseover",function(){d3.select(this).style("opacity",c.attr.hoveropacity),c.attr.tooltip&&c.attr.tooltip.html(c.attr.hovertext).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(){d3.select(this).style("opacity",c.attr.style.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",function(){c.attr.events.click(c.attr)}),e=c.attr.xfixed?c.plot.xstack[0]:c.plot.xscale,f=c.attr.yfixed?c.plot.ystack[0]:c.plot.yscale;if("line"==c.attr.type)var g=p.map(c.attr.x,e),h=p.map(c.attr.y,f);else var g=e(c.attr.x),h=f(c.attr.y);if(c.attr.draggable&&!c.plot.attr.zoomable){var i=d3.behavior.drag().on("dragstart",function(){c.attr.events.dragstart(c.attr)}).on("dragend",function(){c.attr.events.dragend(c.attr)}).on("drag",function(){var a=n(c.plot.attr.svg),b=Math.abs(e(c.attr.width)-e(0)),d=Math.abs(f(c.attr.height)-f(0));b="rect"===c.attr.type?b/2:0,d="rect"===c.attr.type?d/2:0;var i=a.x-c.plot.attr.margin.left-b,j=a.y-c.plot.attr.margin.top-d,k=p.center(i,[0,c.plot.innerwidth-2*b]),l=p.center(j,[0,c.plot.innerheight-2*d]),m="line"===c.attr.type?g[0]:g,o="line"===c.attr.type?h[0]:h;d3.select(this).attr("transform","translate("+(k-m)+","+(l-o)+")");var q=d3.scale.linear().domain(e.range()).range(e.domain()),r=d3.scale.linear().domain(f.range()).range(f.domain());c.attr.x=q(k),c.attr.y=r(l),d3.select(this).select("text").text(c.attr.text),c.attr.events.drag(c.attr)});d.call(i)}var j;return"rect"===c.attr.type?j=d.selectAll(".rect").data([c.attr]).enter().append("rect").attr("class","rect").attr("transform","rotate("+c.attr.rotate+" "+g+" "+h+")").attr("width",Math.abs(e(c.attr.width)-e(0))).attr("height",Math.abs(f(c.attr.height)-f(0))).attr("x",g).attr("y",h):"circle"===c.attr.type?j=d.selectAll(".circle").data([c.attr]).enter().append("circle").attr("class","circle").attr("r",c.attr.size/2).attr("cx",g).attr("cy",h):"triangle"===c.attr.type?j=d.selectAll(".triangle").data([c.attr]).enter().append("path").attr("class","triangle").attr("transform","rotate("+c.attr.rotate+" "+g+" "+h+")").attr("d",function(a){return["M"+(g-a.size/2)+","+(h-a.size/2),"L"+(g+a.size/2)+","+(h-a.size/2),"L"+g+","+(h+a.size/2),"Z"].join("")}):"line"===c.attr.type&&(j=d.selectAll(".line").data([c.attr]).enter().append("line").attr("class","line").attr("stroke-width",c.attr.style["stroke-width"]?c.attr.style["stroke-width"]:2).attr("stroke",c.attr.style.stroke?c.attr.style.stroke:"black").attr("x1",g[0]).attr("x2",g[1]).attr("y1",h[0]).attr("y2",h[1])),"bottom"===c.attr.stack&&d.stagedown(),"text"!==c.attr.type&&p.map(p.without(Object.keys(c.attr.style),"opacity"),function(a){j.style(a,c.attr.style[a])}),""!==c.attr.text&&d.selectAll(".text").data([c.attr]).enter().append("text").attr("class","text").attr("x",function(a){var b="function"==typeof a.text?a.text(a):a.text;return"rect"===a.type?g+a.tmargin.x+2*b.toString().length+2:"circle"===a.type?g+a.tmargin.x:"triangle"===a.type?g+a.tmargin.x+a.size/2-b.toString().length:"line"===a.type?g[0]+a.tmargin.x:g+a.tmargin.x}).attr("y",function(a){return"rect"===a.type?h-a.tmargin.y-5:"circle"===a.type?h-a.size/2-5:"triangle"===a.type?h-a.size/2-5:"line"===a.type?h[0]-a.size/2-5:h-a.tmargin.y}).style("font-size",c.attr.tsize).style("text-anchor","middle").text(c.attr.text),c},this.attr=extend({parent:null,id:a.uuid(),type:"text",text:"",hovertext:"",hoveropacity:.75,xfixed:!1,yfixed:!1,size:15,group:null,rotate:0,tsize:12,tposition:{x:0,y:20},tmargin:{x:0,y:0},trotation:0,x:0,y:0,width:0,height:0,draggable:!1,tooltip:!0,stack:"top",events:{add:function(){a.log("add event")},drag:function(){a.log("drag event")},dragstart:function(){a.log("drag start event")},dragend:function(){a.log("drag end event")},click:function(){a.log("click event")}},style:{opacity:1},meta:{}},b),parameterize(c.attr,c.go),c.go.__parent__=c,c.go.bind=function(a){return arguments.length?(c.attr.parent=a,c.plot=a.__parent__,c.attr.parent=c.plot.attr.id,c.go):c.plot},c.go}function l(a,b){return function(c){return b.map(function(b){return{x:b,y:d3.mean(c,function(c){return a(b-c)})}})}}function m(a){return function(b){return Math.abs(b/=a)<=1?.75*(1-b*b)/a:0}}function n(a){var b=d3.mouse(a.node()),c={};return c.x=b[0],c.y=b[1],c.scale="zoom"==d3.event.type?d3.event.scale:1,c}a.debug=!1,a.error=function(a){console.log("ERROR: "+a)},a.log=function(b){a.debug&&console.log("DEBUG: "+b)},a.render=function(b){a.log("rendering element");var c=b();return"undefined"==typeof b.parent&&(a.plots[b.id()]=c),c},a.plots={};var o,p=function(a){return a instanceof p?a:this instanceof p?void(this._wrapped=a):new p(a)},q=function(a,b,c){if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case null:case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},r=function(a,b,c){return p.iteratee!==o?p.iteratee(a,b):null==a?p.identity:p.isFunction(a)?q(a,b,c):p.isObject(a)&&!p.isArray(a)?p.matcher(a):p.property(a)};p.iteratee=o=function(a,b){return r(a,b,1/0)};var s=function(a,b){return b=null==b?a.length-1:+b,function(){for(var c=Math.max(arguments.length-b,0),d=Array(c),e=0;c>e;e++)d[e]=arguments[e+b];switch(b){case 0:return a.call(this,d);case 1:return a.call(this,arguments[0],d);case 2:return a.call(this,arguments[0],arguments[1],d)}var f=Array(b+1);for(e=0;b>e;e++)f[e]=arguments[e];return f[b]=d,a.apply(this,f)}},t=function(a){return function(b){return null==b?void 0:b[a]}},u=function(a,b){for(var c=b.length,d=0;c>d;d++){if(null==a)return void 0;a=a[b[d]]}return c?a:void 0},v=Math.pow(2,53)-1,w=t("length"),x=function(a){var b=w(a);return"number"==typeof b&&b>=0&&v>=b};p.each=p.forEach=function(a,b,c){b=q(b,c);var d,e;if(x(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=p.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},p.map=p.collect=function(a,b,c){b=r(b,c);for(var d=!x(a)&&p.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f};var y=function(a){var b=function(b,c,d,e){var f=!x(b)&&p.keys(b),g=(f||b).length,h=a>0?0:g-1;for(e||(d=b[f?f[h]:h],h+=a);h>=0&&g>h;h+=a){var i=f?f[h]:h;d=c(d,b[i],i,b)}return d};return function(a,c,d,e){var f=arguments.length>=3;return b(a,q(c,e,4),d,f)}};p.reduce=p.foldl=p.inject=y(1),p.reduceRight=p.foldr=y(-1),p.filter=p.select=function(a,b,c){var d=[];return b=r(b,c),p.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},p.reject=function(a,b,c){return p.filter(a,p.negate(r(b)),c)},p.every=p.all=function(a,b,c){b=r(b,c);for(var d=!x(a)&&p.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},p.some=p.any=function(a,b,c){b=r(b,c);for(var d=!x(a)&&p.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},p.contains=p.includes=p.include=function(a,b,c,d){return x(a)||(a=p.values(a)),("number"!=typeof c||d)&&(c=0),p.indexOf(a,b,c)>=0},p.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b||"number"==typeof b&&"object"!=typeof a[0]&&null!=a){a=x(a)?a:p.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],null!=d&&d>f&&(f=d)}else b=r(b,c),p.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},p.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b||"number"==typeof b&&"object"!=typeof a[0]&&null!=a){a=x(a)?a:p.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],null!=d&&f>d&&(f=d)}else b=r(b,c),p.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},p.shuffle=function(a){return p.sample(a,1/0)},p.sample=function(a,b,c){if(null==b||c)return x(a)||(a=p.values(a)),a[p.random(a.length-1)];var d=x(a)?p.clone(a):p.values(a),e=w(d);b=Math.max(Math.min(b,e),0);for(var f=e-1,g=0;b>g;g++){var h=p.random(g,f),i=d[g];d[g]=d[h],d[h]=i}return d.slice(0,b)};var z=function(a,b,c,d){d=d||[];for(var e=d.length,f=0,g=w(a);g>f;f++){var h=a[f];if(x(h)&&(p.isArray(h)||p.isArguments(h)))if(b)for(var i=0,j=h.length;j>i;)d[e++]=h[i++];else z(h,b,c,d),e=d.length;else c||(d[e++]=h)}return d};p.flatten=function(a,b){return z(a,b,!1)},p.without=s(function(a,b){return p.difference(a,b)}),p.uniq=p.unique=function(a,b,c,d){p.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=r(c,d));for(var e=[],f=[],g=0,h=w(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?p.contains(f,j)||(f.push(j),e.push(i)):p.contains(e,i)||e.push(i)}return e},p.uniquesort=function(a,b){return"undefined"==typeof b&&(b=function(a){return a}),p.unique(p.map(a,b)).sort()},p.union=s(function(a){return p.uniq(z(a,!0,!0))}),p.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=w(a);e>d;d++){var f=a[d];if(!p.contains(b,f)){var g;for(g=1;c>g&&p.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},p.difference=s(function(a,b){return b=z(b,!0,!0),p.filter(a,function(a){return!p.contains(b,a)})});var A=function(a){return function(b,c,d){c=r(c,d);for(var e=w(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}};p.findIndex=A(1),p.findLastIndex=A(-1),p.sortedIndex=function(a,b,c,d){c=r(c,d,1);for(var e=c(b),f=0,g=w(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f};var B=function(a,b,c){return function(d,e,f){var g=0,h=w(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(Array.prototype.slice.call(d,g,h),p.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}};p.indexOf=B(1,p.findIndex,p.sortedIndex),p.lastIndexOf=B(-1,p.findLastIndex),p.range=function(a,b,c){null==b&&(b=a||0,a=0),c||(c=a>b?-1:1);for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e},p.keys=function(a){return p.isObject(a)?Object.keys(a):[]},p.allKeys=function(a){if(!p.isObject(a))return[];var b=[];for(var c in a)b.push(c);return b},p.values=function(a){for(var b=p.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},p.invert=function(a){for(var b={},c=p.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];
return b},p.functions=p.methods=function(a){var b=[];for(var c in a)p.isFunction(a[c])&&b.push(c);return b.sort()};var C=function(a,b){return function(c){var d=arguments.length;if(b&&(c=Object(c)),2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}};p.extend=C(p.allKeys),p.findKey=function(a,b,c){b=r(b,c);for(var d,e=p.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},p.clone=function(a){return p.isObject(a)?p.isArray(a)?a.slice():p.extend({},a):a},p.isEmpty=function(a){return null==a?!0:x(a)&&(p.isArray(a)||p.isString(a)||p.isArguments(a))?0===a.length:0===p.keys(a).length},p.isElement=function(a){return!(!a||1!==a.nodeType)},p.isArray=Array.isArray,p.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},p.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(a){p["is"+a]=function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}}),p.isArguments=function(a){return p.has(a,"callee")},p.isFunction=function(a){return"function"==typeof a||!1},p.isFinite=function(a){return!p.isSymbol(a)&&isFinite(a)&&!isNaN(parseFloat(a))},p.isNaN=function(a){return p.isNumber(a)&&isNaN(a)},p.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===Object.prototype.toString.call(a)},p.isNull=function(a){return null===a},p.isUndefined=function(a){return void 0===a},p.has=function(a,b){if(!p.isArray(b))return null!=a&&Object.prototype.hasOwnProperty.call(a,b);for(var c=b.length,d=0;c>d;d++){var e=b[d];if(null==a||!Object.prototype.hasOwnProperty.call(a,e))return!1;a=a[e]}return!!c},p.identity=function(a){return a},p.noop=function(){},p.property=function(a){return p.isArray(a)?function(b){return u(b,a)}:t(a)},p.propertyOf=function(a){return null==a?p.noop:function(b){return p.isArray(b)?u(a,b):a[b]}},p.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},p.center=function(a,b){return p.min([p.max([a,b[0]]),b[1]])};var D=Math.round(1e5*Math.random());a.seed=function(a){return arguments.length?void(D=a):D},a.random=function(){"undefined"==typeof D&&(D=42);var a=1e4*Math.sin(D++);return a-Math.floor(a)},a.pseudorandom=function(a){var b=1e4*Math.sin(a);return b-Math.floor(b)},a.uuid=function(){function b(){return Math.floor(65536*(1+a.random())).toString(16).substring(1)}return"u"+[b()+b(),b(),b(),b(),b()+b()+b()].join("-")},a["export"]=function(b,c){var d=b.__parent__.attr.svg,e=d.node(),f=e.cloneNode(!0);document.body.appendChild(f);var g=f.getBoundingClientRect();document.body.removeChild(f);var h=a.plot2png(b),i=document.createElement("img");i.setAttribute("src","data:image/svg+xml;base64,"+h),i.onload=function(){var a=document.createElement("canvas");a.width=g.width,a.height=g.height;var b=a.getContext("2d");b.drawImage(i,0,0);var d=a.toDataURL("image/png"),e=document.createElement("a");e.download=c+".png",e.href=d,document.body.appendChild(e),e.click(),e.remove(),a.remove(),i.remove()}},a.plot2png=function(a){var b=a.__parent__.attr.svg,c=b.attr({xmlns:"http://www.w3.org/2000/svg",version:"1.1"}).node(),d=c.cloneNode(!0);d3.select(d).selectAll("clippath").attr("id","clip-export"),d3.select(d).selectAll(".plotarea").attr("clip-path","url(#clip-export)"),d.id="export",document.body.appendChild(d),d3.select(d).style("background-color","#fff"),d3.select(d).selectAll(".glyphbox").remove(),d3.select(d).selectAll("text").style("font-weight",300).style("font-size","12px").style("font-family",'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif'),d3.select(d).selectAll(".axis line").style("stroke","#bbb").style("fill","none").style("shape-rendering","crispEdges"),d3.select(d).selectAll(".axis path").style("stroke","#bbb").style("fill","none").style("shape-rendering","crispEdges"),d3.select(d).selectAll(".axis .tick line").style("stroke","#bbb").style("opacity",.5),d3.select(d).selectAll(".selector").style("stroke","#bbb").style("stroke-width","1px"),d3.select(d).selectAll(".xtick").style("stroke-width","1.5px"),d3.select(d).selectAll(".ytick").style("stroke-width","1.5px");var e=(new XMLSerializer).serializeToString(d),f=btoa(unescape(encodeURIComponent(e)));return document.body.removeChild(d),f},parameterize=function(a,b){Object.keys(a).forEach(function(c){b[c]=function(d){return arguments.length?("object"==typeof d&&"object"==typeof a[c]?(Array.isArray(a[c])&&!Array.isArray(d)&&(d=[d]),a[c]=p.extend(a[c],d)):a[c]=d,b):a[c]}})},extend=function(a,b){return p.map(Object.keys(b),function(c){"undefined"==typeof a[c]&&(a[c]=b[c])}),p.map(Object.keys(a),function(c){"undefined"!=typeof b[c]&&("object"!=typeof a[c]||Array.isArray(a[c])||null==a[c]?Array.isArray(a[c])&&!Array.isArray(b[c])?a[c]=[b[c]]:a[c]=b[c]:a[c]=extend(a[c],b[c]))}),a},selectmerge=function(a,b,c){"undefined"==typeof c&&(c=!0);var d=a;return"single"==c&&(a=[]),p.contains(d,b)?a=p.without(a,b):a.push(b),a},c.prototype=Object.create(b.prototype),c.prototype.constructor=c,a.bar=function(a){return new c(a)},d.prototype=Object.create(g.prototype),d.prototype.constructor=d,a.density=function(a){return new d(a)},e.prototype=Object.create(b.prototype),e.prototype.constructor=e,a.graph=function(a){return new e(a)},f.prototype=Object.create(c.prototype),f.prototype.constructor=f,a.histogram=function(a){return new f(a)},g.prototype=Object.create(b.prototype),g.prototype.constructor=g,a.line=function(a){return new g(a)},h.prototype=Object.create(b.prototype),h.prototype.constructor=h,a.multiline=function(a){return new h(a)},i.prototype=Object.create(b.prototype),i.prototype.constructor=i,a.pie=function(a){return new i(a)},j.prototype=Object.create(b.prototype),j.prototype.constructor=j,a.scatter=function(a){return new j(a)},a.annotation=function(b){return a.log("creating plot annotation"),new k(b)};var E={16:"Shift",17:"Ctrl",18:"Alt",27:"Esc"},F={9:"Tab",13:"Enter",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z"},G=p.extend(p.clone(E),F);a.keys={},a.events={},p.each(E,function(b){a.events[b]={down:function(){},up:function(){}},a.keys[b]=!1,p.each(F,function(c){a.events[b+c]={down:function(){},up:function(){}},a.keys[c]=!1,a.keys[b+c]=!1})}),document.onkeydown=function(b){b=b||window.event;var c=b.which;if(p.has(G,c)){var d=G[c];p.has(E,c)&&(a.keys[d]||a.events[d].down()),a.keys[d]=!0,p.each(E,function(b){p.each(F,function(c){a.keys[b]&&a.keys[c]&&(a.keys[b+c]||(a.events[b+c].down(),a.keys[b+c]=!0))})})}},document.onkeyup=function(b){b=b||window.event;var c=b.which;if(p.has(G,c)){var d=G[c];p.has(E,c)&&a.keys[d]&&a.events[d].up(),a.keys[d]=!1,p.each(E,function(b){p.each(F,function(c){a.keys[b]&&a.keys[c]||a.keys[b+c]&&(a.events[b+c].up(),a.keys[b+c]=!1)})})}},a.version="0.0.5",window.quorra=a}();