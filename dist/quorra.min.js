!function(){function a(){}function b(b){a.log("instantiating quorra plot object"),"undefined"==typeof b&&(b={});var c=this;return this.go=function(b){a.log("running generator function"),"undefined"==typeof b&&(b=c.attr.bind),c.selection="string"==typeof b?d3.select(b):b,null!==c.selection.select("svg")[0][0]&&c.selection.select("svg").selectAll("*").remove(),c.attr.svg=null===c.attr.svg?c.selection.append("svg"):c.attr.svg;var d="auto"===c.attr.width?parseInt(c.selection.style("width")):c.attr.width,e="auto"===c.attr.height?parseInt(c.selection.style("height")):c.attr.height;c.innerwidth=d-c.attr.margin.left-c.attr.margin.right,c.innerheight=e-c.attr.margin.top-c.attr.margin.bottom,c.selection.selectAll("div.tooltip").remove(),c.attr.tooltip===!0&&(c.attr.tooltip=c.selection.append("div").attr("class","tooltip").style("position","fixed").style("visibility","hidden")),c.attr.svg=c.attr.svg.attr("id",c.attr.id).attr("class",c.attr["class"]).attr("width",d).attr("height",e),c.defs=c.attr.svg.append("defs"),c.defs.append("clipPath").attr("id","clip-"+c.attr.id).append("rect").attr("x",0).attr("y",0).attr("width",c.innerwidth).attr("height",c.innerheight),c.plotregion=c.attr.svg.append("g").attr("class","plotregion").attr("transform","translate("+c.attr.margin.left+","+c.attr.margin.top+")"),c.data=c.attr.transform(c.attr.data),"string"==typeof c.data[0].x?c.domain=_.uniquesort(c.data,c.attr.x):c.domain=[_.min(_.map(c.data,c.attr.x)),_.max(_.map(c.data,c.attr.x))];var f;if("string"==typeof c.data[0].y)c.range=_.uniquesort(c.data,c.attr.y);else{if("stacked"===c.attr.layout){var g=_.uniquesort(c.data,c.attr.x);f=_.max(_.map(g,function(a){var b=_.filter(c.data,function(b){return c.attr.x(b)==a}),d=_.map(b,function(a){return c.attr.y(a)});return _.reduce(d,function(a,b){return a+b},0)}))}else f=_.max(_.map(c.data,c.attr.y));c.range=[_.min(_.map(c.data,c.attr.y)),f]}return c.pallette="auto"===c.attr.color?d3.scale.category10():d3.scale.ordinal().range(c.attr.color),c.pallette=c.pallette.domain(_.uniquesort(c.data,c.attr.group)),c.enabled={zoom:!1,pan:!1,annotate:!1},c.xstack=[],c.ystack=[],c.attr.legend&&c.drawlegend(),c.attr.zoomable&&c.enablezoom(),c.attr.annotatable&&c.enableannotation(),c.attr.glyphs&&c.drawglyphs(),c.redraw(),c},this.redraw=function(b,d,e){a.log("redrawing plot"),"undefined"!=typeof b&&(c.attr.xrange=b),"undefined"!=typeof d&&(c.attr.yrange=d),"undefined"==typeof e&&(e=!0),c.plotregion.selectAll("*").remove(),c.axes(),c.plotarea=c.plotregion.append("g").attr("class","plotarea").attr("clip-path","url(#clip-"+c.attr.id+")"),c.plot(),e&&(c.xstack.push(c.xscale),c.ystack.push(c.yscale)),c.attr.annotation&&c.annotate()},this.axes=function(){a.log("redrawing axes");var b="auto"===c.attr.xrange?c.domain:c.attr.xrange,d="auto"===c.attr.yrange?c.range:c.attr.yrange;"histogram"===c.type&&(b[1]=b[1]+(b[1]-b[0])/(c.attr.bins-1)),"string"==typeof c.data[0].x?c.xscale=d3.scale.ordinal().domain(b).range([0,c.innerwidth]).rangePoints([0,c.innerwidth],1):c.xscale=d3.scale.linear().domain(b).range([0,c.innerwidth]),"string"==typeof c.data[0].y?c.yscale=d3.scale.ordinal().domain(d).range([0,c.innerheight]).rangePoints([c.innerheight,0],1):c.yscale=d3.scale.linear().domain(d).range([c.innerheight,0]),c.xaxis=d3.svg.axis().scale(c.xscale).orient(c.attr.xorient),"auto"!==c.attr.xticks?c.xaxis=c.xaxis.ticks(c.attr.xticks):"histogram"===c.type&&(c.xaxis=c.xaxis.ticks(c.attr.bins)),c.yaxis=d3.svg.axis().scale(c.yscale).orient(c.attr.yorient),"auto"!==c.attr.yticks&&(c.yaxis=c.yaxis.ticks(c.attr.yticks)),"auto"!==c.attr.xformat&&(c.xaxis=c.xaxis.tickFormat(c.attr.xformat)),"auto"!==c.attr.yformat&&(c.yaxis=c.yaxis.tickFormat(c.attr.yformat)),c.attr.grid&&(c.xaxis=c.xaxis.tickSize(-c.innerheight,0,0),c.yaxis=c.yaxis.tickSize(-c.innerwidth,0,0)),"hidden"!==c.attr.xaxis&&c.attr.xaxis!==!1&&c.plotregion.append("g").attr("class","x axis").attr("transform","translate(0,"+c.innerheight+")").call(c.xaxis).append("text").attr("class","label").attr("x",function(a){return"end"===c.attr.labelposition?c.innerwidth:"middle"===c.attr.labelposition?c.innerwidth/2:"beginning"===c.attr.labelposition?0:void 0}).attr("y",function(){return"inside"===c.attr.xaxis?-6+c.attr.labelpadding.x:"outside"===c.attr.xaxis?35+c.attr.labelpadding.x:void 0}).style("text-anchor",c.attr.labelposition).text(c.attr.xlabel),"hidden"!==c.attr.yaxis&&c.attr.yaxis!==!1&&c.plotregion.append("g").attr("class","y axis").call(c.yaxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",function(a){return"end"===c.attr.labelposition?0:"middle"===c.attr.labelposition?-c.innerheight/2:"beginning"===c.attr.labelposition?-c.innerheight:void 0}).attr("y",function(){return"inside"===c.attr.yaxis?6+c.attr.labelpadding.y:"outside"===c.attr.yaxis?-40+c.attr.labelpadding.y:void 0}).attr("dy",".71em").style("text-anchor",c.attr.labelposition).text(c.attr.ylabel)},this.plot=function(){a.log("To be implemented by models ...")},this.annotate=function(){a.log("drawing plot annotation"),c.selection.selectAll("div.annotation-tooltip").remove(),_.map(c.attr.annotation,function(b){a.render(b)})},this.drawlegend=function(){a.log("drawing plot legend");var b=c.pallette.domain();c.attr.lorder.length===b.length&&(b=c.attr.lorder);var d="auto"===c.attr.width?parseInt(c.selection.style("width")):c.attr.width;"auto"===c.attr.height?parseInt(c.selection.style("height")):c.attr.height;d="inside"===c.attr.lposition?d-22:d;var e,f=c.attr.svg.append("g").attr("transform","translate("+(d-c.attr.margin.right)+","+c.attr.margin.top+")").selectAll(".legend").data(b).enter().append("g").attr("class","legend").attr("id",c.attr.id+"-legend").attr("transform",function(a,b){return"translate(0,"+(c.attr.lmargin.top+20*b)+")"});"square"===c.attr.lshape?e=f.append("rect").attr("class","selector").attr("x",5+c.attr.lmargin.left).attr("y",c.attr.lmargin.top).attr("width",18).attr("height",18).attr("rx",5).attr("ry",5).style("fill",c.pallette).style("fill-opacity",function(a){return _.contains(c.attr.toggled,a)?0:c.attr.opacity}):"circle"===c.attr.lshape&&(e=f.append("circle").attr("class","selector").attr("cx",20+c.attr.lmargin.left).attr("cy",8+c.attr.lmargin.top).attr("r",9).style("fill",c.pallette).style("fill-opacity",function(a){return _.contains(c.attr.toggled,a)?0:c.attr.opacity})),c.attr.toggle&&e.on("mouseover",function(a,b){d3.select(this).style("opacity",.75)}).on("mouseout",function(a,b){d3.select(this).style("opacity",1)}).on("click",function(a,b){0===parseFloat(d3.select(this).style("fill-opacity"))?(d3.select(this).style("fill-opacity",_.contains(c.attr.toggled,a)?c.attr.opacity:0),c.attr.svg.selectAll(".g_"+a).style("visibility","visible"),c.attr.toggled=_.without(c.attr.toggled,a)):(d3.select(this).style("fill-opacity",0),c.attr.svg.selectAll(".g_"+a).style("visibility","hidden"),c.attr.toggled=_.union(c.attr.toggled,[a]))}),f.append("text").attr("x",function(){if("inside"===c.attr.lposition)return c.attr.lmargin.left;if("outside"===c.attr.lposition){var a="square"===c.attr.lshape?0:7;return 27+c.attr.lmargin.left+a}}).attr("y",9+c.attr.lmargin.top).attr("dy",".35em").style("text-anchor",function(){return"inside"===c.attr.lposition?"end":"outside"===c.attr.lposition?"beginning":void 0}).text(function(a){return a})},this.drawglyphs=function(){a.log("drawing plot glyphs"),c.defs.append("symbol").attr("id","glyph-refresh").attr("viewBox","0 0 1024 1024").append("path").attr("d","M1024 384h-384l143.53-143.53c-72.53-72.526-168.96-112.47-271.53-112.47s-199 39.944-271.53 112.47c-72.526 72.53-112.47 168.96-112.47 271.53s39.944 199 112.47 271.53c72.53 72.526 168.96 112.47 271.53 112.47s199-39.944 271.528-112.472c6.056-6.054 11.86-12.292 17.456-18.668l96.32 84.282c-93.846 107.166-231.664 174.858-385.304 174.858-282.77 0-512-229.23-512-512s229.23-512 512-512c141.386 0 269.368 57.326 362.016 149.984l149.984-149.984v384z"),c.defs.append("symbol").attr("id","glyph-search").attr("viewBox","0 0 1024 1024").append("path").attr("d","M992.262 871.396l-242.552-206.294c-25.074-22.566-51.89-32.926-73.552-31.926 57.256-67.068 91.842-154.078 91.842-249.176 0-212.078-171.922-384-384-384-212.076 0-384 171.922-384 384s171.922 384 384 384c95.098 0 182.108-34.586 249.176-91.844-1 21.662 9.36 48.478 31.926 73.552l206.294 242.552c35.322 39.246 93.022 42.554 128.22 7.356s31.892-92.898-7.354-128.22zM384 640c-141.384 0-256-114.616-256-256s114.616-256 256-256 256 114.616 256 256-114.614 256-256 256z"),c.defs.append("symbol").attr("id","glyph-image").attr("viewBox","0 0 1024 1024").html(['<path d="M959.884 128c0.040 0.034 0.082 0.076 0.116 0.116v767.77c-0.034 0.040-0.076 0.082-0.116 0.116h-895.77c-0.040-0.034-0.082-0.076-0.114-0.116v-767.772c0.034-0.040 0.076-0.082 0.114-0.114h895.77zM960 64h-896c-35.2 0-64 28.8-64 64v768c0 35.2 28.8 64 64 64h896c35.2 0 64-28.8 64-64v-768c0-35.2-28.8-64-64-64v0z"></path>','<path d="M832 288c0 53.020-42.98 96-96 96s-96-42.98-96-96 42.98-96 96-96 96 42.98 96 96z"></path>','<path d="M896 832h-768v-128l224-384 256 320h64l224-192z"></path>'].join("")),c.defs.append("symbol").attr("id","glyph-pan").attr("viewBox","0 0 1024 1024").html(['<path d="M1024 0h-416l160 160-192 192 96 96 192-192 160 160z"></path>','<path d="M1024 1024v-416l-160 160-192-192-96 96 192 192-160 160z"></path>','<path d="M0 1024h416l-160-160 192-192-96-96-192 192-160-160z"></path>','<path d="M0 0v416l160-160 192 192 96-96-192-192 160-160z"></path>'].join("")),c.defs.append("symbol").attr("id","glyph-annotate").attr("viewBox","0 0 1024 1024").append("path").attr("d","M864 0c88.364 0 160 71.634 160 160 0 36.020-11.91 69.258-32 96l-64 64-224-224 64-64c26.742-20.090 59.978-32 96-32zM64 736l-64 288 288-64 592-592-224-224-592 592zM715.578 363.578l-448 448-55.156-55.156 448-448 55.156 55.156z");var b=[];c.attr.annotatable&&b.push("annotate"),c.attr.zoomable&&b.push("pan","refresh"),c.attr.exportable&&b.push("export");var d=c.attr.svg.append("g").attr("transform","translate("+(c.innerwidth+c.attr.margin.left+7)+","+(c.innerheight-c.attr.margin.bottom-22*b.length+52)+")").selectAll(".glyphbox").data(b).enter().append("g").attr("class","glyphbox").attr("id",function(a){return a}).attr("transform",function(a,b){return"translate(0,"+25*b+")"}).on("mouseover",function(a){d3.select(this).style("opacity",.5),c.attr.tooltip&&c.attr.tooltip.html(a).style("visibility","visible").style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",1),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",function(b){switch(b){case"zoom":c.enabled.zoom=!c.enabled.zoom,this.enabled.pan=!c.enabled.pan,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.zoom?2:1).style("stroke",c.enabled.zoom?"black":"#ddd");break;case"pan":c.enabled.pan=!c.enabled.pan,c.enabled.zoom=!c.enabled.zoom,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.pan?2:1).style("stroke",c.enabled.pan?"black":"#ddd");break;case"refresh":c.xstack=[c.xstack[0]],c.ystack=[c.ystack[0]],c.redraw(c.xstack[0].domain(),c.ystack[0].domain(),!1);break;case"annotate":c.enabled.annotate=!c.enabled.annotate,d3.select(this).selectAll(".glyph").style("stroke-width",c.enabled.annotate?2:1).style("stroke",c.enabled.annotate?"black":"#ddd");break;case"export":c.attr.events.preexport(c.attr),a["export"](c.attr.svg,c.attr.plotname),c.attr.events.postexport(c.attr)}});"square"===c.attr.gshape?d.append("rect").attr("class","glyph").attr("width",22).attr("height",22).attr("rx",5).attr("ry",5).style("fill","transparent"):d.append("circle").attr("class","glyph").attr("cx",11).attr("cy",7).attr("r",11).style("fill","transparent"),d.append("svg").attr("width",22).attr("height",22).append("use").attr("x",("square"===c.attr.gshape,4)).attr("y","square"===c.attr.gshape?4:0).attr("height",14).attr("width",14).attr("xlink:href",function(a){switch(a){case"zoom":return"#glyph-search";case"pan":return"#glyph-pan";case"refresh":return"#glyph-refresh";case"export":return"#glyph-image";case"annotate":return"#glyph-annotate"}})},this.enablezoom=function(){function b(a){return a.x>c.innerwidth||a.x<0||a.y>c.innerheight||a.y<0?!1:!0}a.log("enabling zoom events"),c.zoomdata={x:c.attr.margin.left,y:c.attr.margin.right},c.enabled.pan=!1,c.enabled.zoom=!0;var e=c.attr.svg.append("path").attr("class","viewbox").attr("transform","translate("+c.attr.margin.left+","+c.attr.margin.top+")"),f=d3.behavior.drag().on("dragstart",function(a){var b=d(c.attr.svg);c.zoomdata.x=b.x-c.attr.margin.left,c.zoomdata.y=b.y-c.attr.margin.top,c.enabled.pan&&c.attr.events.panstart(c.attr)}).on("dragend",function(a){e.attr("d","");var b=d(c.attr.svg);if(b.x=b.x-c.attr.margin.left,b.y=b.y-c.attr.margin.top,c.enabled.zoom){var f,g,h=!1,i=c.xstack.length;if(Math.abs(c.zoomdata.x-b.x)>10&&c.zoomdata.x>0){var j=c.xstack[i-1].domain(),k=c.xstack[i-1].range(),l=d3.scale.linear().domain(k).range(j);f=[l(c.zoomdata.x),l(b.x)].sort(function(a,b){return a-b}),f[0]=Math.max(f[0],j[0]),f[1]=Math.min(f[1],j[1]);d3.scale.linear().domain(f).range(k);h=!0}if(Math.abs(c.zoomdata.y-b.y)>10&&c.zoomdata.y<c.innerheight){var m=c.ystack[i-1].domain(),n=c.ystack[i-1].range(),o=d3.scale.linear().domain(n).range(m);g=[o(c.zoomdata.y),o(b.y)].sort(function(a,b){return a-b}),g[0]=Math.max(g[0],m[0]),g[1]=Math.min(g[1],m[1]);d3.scale.linear().domain(g).range(n);h=!0}h&&(c.redraw(f,g,!0),c.attr.events.zoom(c.attr))}else c.enabled.pan&&(c.xstack.push(c.xscale),c.ystack.push(c.yscale),c.attr.events.panend(c.attr))}).on("drag",function(a){var f=d(c.attr.svg);if(f.x=f.x-c.attr.margin.left,f.y=f.y-c.attr.margin.top,c.enabled.zoom)c.zoomdata.y>c.innerheight&&(f.y=0),c.zoomdata.x<0&&(f.x=c.innerwidth),e.attr("d",["M"+c.zoomdata.x+","+c.zoomdata.y,"L"+c.zoomdata.x+","+f.y,"L"+f.x+","+f.y,"L"+f.x+","+c.zoomdata.y,"Z"].join(""));else if(c.enabled.pan&&b(f)){e.attr("d","");var g=d3.scale.linear().domain(c.xscale.range()).range(c.xscale.domain()),h=d3.scale.linear().domain(c.yscale.range()).range(c.yscale.domain()),i=_.map(c.xscale.range(),function(a){return g(a-d3.event.dx)}),j=_.map(c.yscale.range(),function(a){return h(a-d3.event.dy)});c.redraw(i,j,!1);var k=c.xstack.length;c.xscale=d3.scale.linear().domain(i).range(c.xstack[k-1].range()),c.yscale=d3.scale.linear().domain(j).range(c.ystack[k-1].range()),c.attr.events.pan(c.attr)}});c.attr.svg.on("dblclick",function(){var a=c.xstack.length;a>1&&(c.xstack.pop(),c.ystack.pop(),a-=1),c.redraw(c.xstack[a-1].domain(),c.ystack[a-1].domain(),!1)}).call(f).on("dblclick.zoom",null).on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),a.events.Shift.down=function(){d3.selectAll(".glyphbox#pan").selectAll(".glyph").style("stroke","black").style("stroke-width",2),_.each(Object.keys(a.plots),function(b){a.plots[b].enabled.pan=!0,a.plots[b].enabled.zoom=!1})},a.events.Shift.up=function(){d3.selectAll(".glyphbox#pan").selectAll(".glyph").style("stroke","#ddd").style("stroke-width",1),_.each(Object.keys(a.plots),function(b){a.plots[b].enabled.pan=!1,a.plots[b].enabled.zoom=!0})}},this.enableannotation=function(){a.log("enabling annotation events"),c.attr.svg.on("click",function(){if(c.enabled.annotate){var b=d(c.attr.svg);if(b.x>c.innerwidth+c.attr.margin.left||b.x<c.attr.margin.left||b.y>c.innerheight+c.attr.margin.top||b.y<c.attr.margin.top)return;var e=d3.scale.linear().domain(c.xscale.range()).range(c.xscale.domain()),f=d3.scale.linear().domain(c.yscale.range()).range(c.yscale.domain()),g={x:e(b.x-c.attr.margin.left),y:f(b.y-c.attr.margin.top)};for(var h in c.attr.annotation){var i=c.attr.annotation[h];if(Math.abs(c.xscale(i.x())-c.xscale(g.x))<20&&Math.abs(c.yscale(i.y())-c.yscale(g.y))<20)return}var j={};_.map(Object.keys(c.attr.annotatable),function(a){"add"===a||"function"!=typeof c.attr.annotatable[a]?j[a]=c.attr.annotatable[a]:j[a]=c.attr.annotatable[a](g)});var k=a.annotation(j).bind(c.go).x(g.x).y(g.y);j.x=g.x,j.y=g.y,c.attr.annotation.push(k),c.annotate(),k.events().add(j)}}),a.events.ShiftA.down=function(){d3.selectAll(".glyphbox#annotate").selectAll(".glyph").style("stroke","black").style("stroke-width",2),_.each(Object.keys(a.plots),function(b){a.plots[b].enabled.annotate=!0})},a.events.ShiftA.up=function(){d3.selectAll(".glyphbox#annotate").selectAll(".glyph").style("stroke","#ddd").style("stroke-width",1),_.each(Object.keys(a.plots),function(b){a.plots[b].enabled.annotate=!1})}},this.attr=extend({id:a.uuid(),plotname:"quorra-plot",type:"quorra-plot",width:"auto",height:"auto",margin:{top:20,bottom:40,left:40,right:65},svg:null,bind:"body",data:[],x:function(a,b){return a.x},y:function(a,b){return a.y},group:function(a,b){return"undefined"==typeof a.group?0:a.group},label:function(a,b){return"undefined"==typeof a.label?b:a.label},transform:function(a){return a},color:"auto",xrange:"auto",yrange:"auto",groupclick:function(a,b){},labelclick:function(a,b){},zoomable:!1,annotatable:!1,exportable:!1,events:{zoom:function(){a.log("zoom event")},pan:function(){a.log("pan event")},panstart:function(){a.log("pan start event")},panend:function(){a.log("pan end event")},preexport:function(){a.log("pre export event")},postexport:function(){a.log("post export event")}},grid:!1,xticks:"auto",yticks:"auto",xaxis:"outside",yaxis:"outside",xformat:"auto",yformat:"auto",xorient:"bottom",yorient:"left",xlabel:"",ylabel:"",labelposition:"middle",labelpadding:{x:0,y:0},opacity:1,legend:!0,lmargin:{top:0,bottom:0,left:0,right:0},lposition:"outside",lshape:"square",lorder:[],toggle:!0,toggled:[],tooltip:!0,glyphs:!0,gshape:"circle",annotation:[]},b),parameterize(c.attr,c.go),c.go.__parent__=c,c.go.annotation=function(b){return arguments.length?(c.attr.annotation=_.map(b,function(b){return"function"!=typeof b&&(b=a.annotation(b).bind(c.go)),b}),c.go):_.map(c.attr.annotation,function(a){return a.__parent__.attr})},c.go.add=function(a){return"undefined"==typeof c.attr.annotation?c.attr.annotation=[a]:c.attr.annotation.push(a),c.go},this.go}function c(b){a.log("instantiating annotation object"),"undefined"==typeof b&&(b={}),"undefined"==typeof plot&&(plot="body");var c=this;return this.go=function(){a.log("running annotation generator function"),c.attr.tooltip&&(c.attr.tooltip=c.plot.selection.append("div").attr("class","annotation-tooltip").style("position","fixed").style("visibility","hidden")),c.plot.plotarea.selectAll(".annotation#"+c.attr.id).remove();var b=null===c.attr.group?"annotation "+c.attr.type:"annotation "+c.attr.type+" g_"+c.attr.group,e=c.plot.plotarea.append("g").attr("id",c.attr.id).attr("class",b).style("visibility",function(){return _.contains(c.plot.attr.toggled,c.plot.attr.group(c.attr))?"none":"visible"}).style("opacity",c.attr.style.opacity).on("mouseover",function(){d3.select(this).style("opacity",.75*c.attr.style.opacity),c.attr.tooltip&&c.attr.tooltip.html(c.attr.hovertext).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(){d3.select(this).style("opacity",c.attr.style.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",function(){c.attr.events.click(c.attr)}),f=c.plot.xscale(c.attr.x),g=c.plot.yscale(c.attr.y);if(c.attr.draggable&&!c.plot.attr.zoomable){var h=d3.behavior.drag().on("dragstart",function(){c.attr.events.dragstart(c.attr)}).on("dragend",function(){c.attr.events.dragend(c.attr)}).on("drag",function(){var a=d(c.plot.attr.svg),b=Math.abs(c.plot.xscale(c.attr.width)-c.plot.xscale(0)),e=Math.abs(c.plot.yscale(c.attr.height)-c.plot.yscale(0));b="rect"===c.attr.type?b/2:0,e="rect"===c.attr.type?e/2:0;var h=a.x-c.plot.attr.margin.left-b,i=a.y-c.plot.attr.margin.top-e,j=_.center(h,[0,c.plot.innerwidth-2*b]),k=_.center(i,[0,c.plot.innerheight-2*e]);d3.select(this).attr("transform","translate("+(j-f)+","+(k-g)+")");var l=d3.scale.linear().domain(c.plot.xscale.range()).range(c.plot.xscale.domain()),m=d3.scale.linear().domain(c.plot.yscale.range()).range(c.plot.yscale.domain());c.attr.x=l(j),c.attr.y=m(k),d3.select(this).select("text").text(c.attr.text),c.attr.events.drag(c.attr)});e.call(h)}var i;return"rect"===c.attr.type?i=e.selectAll(".rect").data([c.attr]).enter().append("rect").attr("class","rect").attr("transform","rotate("+c.attr.rotate+" "+f+" "+g+")").attr("width",Math.abs(c.plot.xscale(c.attr.width)-c.plot.xscale(0))).attr("height",Math.abs(c.plot.yscale(c.attr.height)-c.plot.yscale(0))).attr("x",f).attr("y",g):"circle"===c.attr.type?i=e.selectAll(".circle").data([c.attr]).enter().append("circle").attr("class","circle").attr("r",c.attr.size/2).attr("cx",f).attr("cy",g):"triangle"===c.attr.type&&(i=e.selectAll(".triangle").data([c.attr]).enter().append("path").attr("class","triangle").attr("transform","rotate("+c.attr.rotate+" "+f+" "+g+")").attr("d",function(a){return["M"+(f-a.size/2)+","+(g-a.size/2),"L"+(f+a.size/2)+","+(g-a.size/2),"L"+f+","+(g+a.size/2),"Z"].join("")})),"text"!==c.attr.type&&_.map(_.without(Object.keys(c.attr.style),"opacity"),function(a){i.style(a,c.attr.style[a])}),""!==c.attr.text&&e.selectAll(".text").data([c.attr]).enter().append("text").attr("class","text").attr("x",function(a){var b="function"==typeof a.text?a.text(a):a.text,c=f+a.tmargin.x+2*b.toString().length;return"rect"===a.type?c+2:"circle"===a.type?f+a.tmargin.x:"triangle"===a.type?f+a.tmargin.x+a.size/2-3*b.toString().length:f+a.tmargin.x}).attr("y",function(a){var b=g-a.size/2-5;return"rect"===a.type?g-a.tmargin.y-5:"circle"===a.type?b:"triangle"===a.type?b:g-a.tmargin.y}).style("font-size",c.attr.tsize).style("text-anchor","middle").text(c.attr.text),c},this.attr=extend({parent:null,id:a.uuid(),type:"text",text:"",hovertext:"",xfixed:!1,yfixed:!1,size:15,group:null,rotate:0,tsize:12,tposition:{x:0,y:20},tmargin:{x:0,y:0},trotation:0,x:0,y:0,width:0,height:0,draggable:!1,tooltip:!0,events:{add:function(){a.log("add event")},drag:function(){a.log("drag event")},dragstart:function(){a.log("drag start event")},dragend:function(){a.log("drag end event")},click:function(){a.log("click event")}},style:{opacity:1},meta:{}},b),parameterize(c.attr,c.go),c.go.__parent__=c,c.go.bind=function(a){return arguments.length?(c.attr.parent=a,c.plot=a.__parent__,c.attr.parent=c.plot.attr.id,c.go):c.plot},c.go}function d(a){var b=d3.mouse(a.node()),c={};return c.x=b[0],c.y=b[1],c.scale="zoom"==d3.event.type?d3.event.scale:1,c}function e(a,b){return function(c){return b.map(function(b){return{x:b,y:d3.mean(c,function(c){return a(b-c)})}})}}function f(a){return function(b){return Math.abs(b/=a)<=1?.75*(1-b*b)/a:0}}function g(a){var c=this;return"undefined"==typeof a&&(a={}),b.call(this,extend({"class":"quorra-bar",layout:"stacked"},a)),this.type="bar",this.plot=function(){var a=[],b=c.pallette.domain();for(var d in b){var e=_.filter(c.data,function(a){return a.group==b[d]});e=_.map(e,function(a){return a.layer=d,a}),a.push(_.filter(e,function(a){return a.group==b[d]}))}for(var f=_.map(a[0],function(a){return 0}),g=0;g<a.length;g++)a[g]=_.map(a[g],function(a,b){return a.y0=f[b],f[b]=f[b]+a.y,a});var h=c.plotarea.selectAll(".layer").remove().data(a).enter().append("g").attr("class","layer");h.selectAll("rect").remove().data(function(a){return a}).enter().append("rect").attr("class",function(a,b){return"bar g_"+a.group}).attr("x",function(b,d){if(a[0].length>1){if("stacked"===c.attr.layout)return c.xscale(c.attr.x(b,d));var e=Math.abs(c.xscale(c.attr.x(a[0][1]))-c.xscale(c.attr.x(a[0][0])));return c.xscale(c.attr.x(b,d))+c.pallette.range().indexOf(c.pallette(b.group))*(e/c.pallette.domain().length)}var f=c.xscale.range();return f[1]-f[0]-2}).attr("y",function(a,b){return"stacked"==c.attr.layout?c.yscale(a.y0+a.y):c.yscale(a.y)}).attr("height",function(a,b){return"stacked"==c.attr.layout?c.yscale(a.y0)-c.yscale(a.y0+a.y):_.max([c.innerheight-c.yscale(a.y),0])}).attr("width",function(b){if(a[0].length>1){var d=Math.abs(c.xscale(c.attr.x(a[0][1]))-c.xscale(c.attr.x(a[0][0])));return"stacked"===c.attr.layout?d-2:d/c.pallette.domain().length-2}var e=c.xscale.range();return e[1]-e[0]-2}).attr("fill",function(a,b){return c.pallette(a.group)}).style("opacity",c.attr.opacity).style("visibility",function(a){return _.contains(c.attr.toggled,a.group)?"hidden":"visible"}).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),c.attr.tooltip&&c.attr.tooltip.html(a.label).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",c.attr.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")})},this.go}function h(a){var b=this;return"undefined"==typeof a&&(a={}),j.call(this,extend({"class":"quorra-density",resolution:10},a)),this.type="density",b.attr.transform=function(a){var c=d3.format(".04f"),d=e(f(9),d3.scale.linear().ticks(b.attr.resolution)),g=_.uniquesort(a,b.attr.group),h=[];for(var i in g){var j=_.filter(a,function(a){return a.group==g[i]}),k=d(_.map(j,function(a){return a.x}));k=_.map(k,function(a){return{x:a.x,y:a.y,group:g[i],label:c(a.y)}}),h=h.concat(k)}return h},this.go}function i(a){var b=this;return"undefined"==typeof a&&(a={}),g.call(this,extend({"class":"quorra-histogram",bins:10,display:"counts"},a)),this.type="histogram",b.attr.transform=function(a){if("percent"==b.attr.display)var c=d3.format("0.02%");else if("counts"==b.attr.display)var c=d3.format(".0f");else if("fraction"==b.attr.display)var c=d3.format(".02f");var d=d3.layout.histogram().frequency(!1).bins(d3.scale.linear().ticks(b.attr.bins)),e=_.uniquesort(a,b.attr.group),f=[];for(var g in e){var h=_.filter(a,function(a){return a.group==e[g]}),i=d(_.map(h,function(a){return a.x}));i=_.map(i,function(a){return"counts"==b.attr.display?a.y=a.y*h.length:"percent"==b.attr.display&&(a.y=a.y),{x:a.x,y:a.y,group:e[g],label:c(a.y)}}),f=f.concat(i)}return f},this.go}function j(a){var c=this;return"undefined"==typeof a&&(a={}),b.call(this,extend({"class":"quorra-line",points:0,size:3,layout:"line",interpolate:"linear"},a)),this.type="line",this.plot=function(){var a=d3.svg.line().x(function(a,b){return c.xscale(c.attr.x(a,b))}).y(function(a,b){return c.yscale(c.attr.y(a,b))}).interpolate(c.attr.interpolate),b=c.pallette.domain();for(var d in b){var e=_.filter(c.data,function(a){return a.group==b[d]});c.plotarea.append("path").datum(e).attr("class",function(a,b){return"line g_"+a[0].group}).attr("d",function(b){var d=a(b);return"line"===c.attr.layout?d:"area"===c.attr.layout?[d,"L"+c.xscale(c.domain[1])+","+c.yscale(c.range[0]),"L"+c.xscale(c.domain[0])+","+c.yscale(c.range[0]),"Z"].join(""):void 0}).style("fill",function(a){return"line"===c.attr.layout?"none":"area"===c.attr.layout?c.pallette(a[0].group):void 0}).style("stroke",c.pallette(b[d])).style("stroke-width",c.attr.size).style("opacity",c.attr.opacity).style("visibility",function(a,b){return _.contains(c.attr.toggled,c.attr.group(a[0],b))?"hidden":"visible"}).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),c.attr.tooltip&&c.attr.tooltip.html(a[0].group).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",c.attr.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",c.attr.groupclick)}c.attr.points>0&&c.plotarea.selectAll(".dot").remove().data(c.data).enter().append("circle").attr("class",function(a,b){return"dot g_"+a.group}).attr("r",c.attr.points).attr("cx",function(a,b){return c.xscale(c.attr.x(a,b))}).attr("cy",function(a,b){return c.yscale(c.attr.y(a,b))}).style("fill",function(a,b){return c.pallette(c.attr.group(a,b))}).style("opacity",c.attr.opacity).style("visibility",function(a,b){return _.contains(c.attr.toggled,c.attr.group(a,b))?"hidden":"visible"}).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),c.attr.tooltip&&c.attr.tooltip.html(c.attr.label(a,b)).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",c.attr.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",c.attr.labelclick)},this.go}function k(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-multiline",points:0,size:3,layout:"line",interpolate:"linear"},c)),this.type="multiline",this.axes=function(){a.log("redrawing axes");var b="auto"===d.attr.xrange?d.domain:d.attr.xrange,c="auto"===d.attr.yrange?d.range:d.attr.yrange;"histogram"===d.type&&(b[1]=b[1]+(b[1]-b[0])/(d.attr.bins-1)),"string"==typeof d.data[0].x?d.xscale=d3.scale.ordinal().domain(b).range([0,d.innerwidth]).rangePoints([0,d.innerwidth],1):d.xscale=d3.scale.linear().domain(b).range([0,d.innerwidth]),"string"==typeof d.data[0].y?d.yscale=d3.scale.ordinal().domain(c).range([0,d.innerheight]).rangePoints([d.innerheight,0],1):d.yscale=d3.scale.linear().domain(c).range([d.innerheight,0]),d.xaxis=d3.svg.axis().scale(d.xscale).orient(d.attr.xorient),"auto"!==d.attr.xticks?d.xaxis=d.xaxis.ticks(d.attr.xticks):"histogram"===d.type&&(d.xaxis=d.xaxis.ticks(d.attr.bins)),d.yaxis=d3.svg.axis().scale(d.yscale).orient(d.attr.yorient),"auto"!==d.attr.yticks&&(d.yaxis=d.yaxis.ticks(d.attr.yticks)),"auto"!==d.attr.xformat&&(d.xaxis=d.xaxis.tickFormat(d.attr.xformat)),"auto"!==d.attr.yformat&&(d.yaxis=d.yaxis.tickFormat(d.attr.yformat)),d.attr.grid&&(d.xaxis=d.xaxis.tickSize(-d.innerheight,0,0),d.yaxis=d.yaxis.tickSize(-d.innerwidth,0,0)),"hidden"!==d.attr.xaxis&&d.attr.xaxis!==!1&&d.plotarea.append("g").attr("class","x axis").attr("transform","translate(0,"+d.innerheight+")").call(d.xaxis).append("text").attr("class","label").attr("x",function(a){return"end"===d.attr.labelposition?d.innerwidth:"middle"===d.attr.labelposition?d.innerwidth/2:"beginning"===d.attr.labelposition?0:void 0}).attr("y",function(){return"inside"===d.attr.xaxis?-6+d.attr.labelpadding.x:"outside"===d.attr.xaxis?35+d.attr.labelpadding.x:void 0}).style("text-anchor",d.attr.labelposition).text(d.attr.xlabel),"hidden"!==d.attr.yaxis&&d.attr.yaxis!==!1&&d.plotarea.append("g").attr("class","y axis").call(d.yaxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",function(a){return"end"===d.attr.labelposition?0:"middle"===d.attr.labelposition?-d.innerheight/2:"beginning"===d.attr.labelposition?-d.innerheight:void 0}).attr("y",function(){return"inside"===d.attr.yaxis?6+d.attr.labelpadding.y:"outside"===d.attr.yaxis?-40+d.attr.labelpadding.y:void 0}).attr("dy",".71em").style("text-anchor",d.attr.labelposition).text(d.attr.ylabel)},this.plot=function(){},this.go}function l(a){var c=this;return"undefined"==typeof a&&(a={}),b.call(this,extend({"class":"quorra-pie",aggregate:function(a){return a[0]},radius:"auto",inner:"auto"},a)),this.type="pie",this.axes=function(){},this.plot=function(){var a="auto"==c.attr.width?parseInt(c.selection.style("width")):c.attr.width,b="auto"==c.attr.height?parseInt(c.selection.style("height")):c.attr.height;a=a-c.attr.margin.left-c.attr.margin.right,b=b-c.attr.margin.top-c.attr.margin.bottom;var d="auto"==c.attr.radius?Math.min(a,b)/2:c.attr.radius,e="auto"==c.attr.inner?0:c.attr.inner,f=[],g=c.pallette.domain();for(var h in g){var i=_.filter(c.data,function(a){return a.group==g[h]});f.push({x:c.attr.aggregate(_.map(i,function(a){
return a.x})),group:g[h],label:i.length<=1?g[h]:i.length+" "+g[h]})}var j=d3.svg.arc().outerRadius(d).innerRadius(e),k=d3.layout.pie().sort(null).value(function(a){return a.x}),l=c.plotregion.attr("transform","translate("+c.innerwidth/2+","+c.innerheight/2+")").selectAll(".arc").data(k(f)).enter().append("g").attr("class",function(a){return"arc g_"+a.data.group}).style("visibility",function(a){return _.contains(c.attr.toggled,c.attr.group(a.data))?"hidden":"visible"});l.append("path").attr("d",j).style("fill",function(a,b){return c.pallette(c.attr.group(a.data,b))}).style("opacity",c.attr.opacity).on("mouseover",function(a,b){d3.select(this).style("opacity",.25),c.attr.tooltip&&c.attr.tooltip.html(c.attr.label(a.data,b)).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(a){c.attr.tooltip&&c.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",c.attr.opacity),c.attr.tooltip&&c.attr.tooltip.style("visibility","hidden")}).on("click",c.attr.labelclick)},this.go}function m(c){var d=this;return"undefined"==typeof c&&(c={}),b.call(this,extend({"class":"quorra-scatter",lm:!1,xdensity:!1,ydensity:!1,xjitter:0,yjitter:0,size:5},c)),this.type="scatter",this.plot=function(){d.plotarea.selectAll(".dot").remove().data(d.data).enter().append("circle").attr("class",function(a,b){return"dot g_"+a.group}).attr("r",d.attr.size).attr("cx",function(b,c){return(a.random()-.5)*d.attr.xjitter+d.xscale(d.attr.x(b,c))}).attr("cy",function(b,c){return(a.random()-.5)*d.attr.yjitter+d.yscale(d.attr.y(b,c))}).style("fill",function(a,b){return d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a){return _.contains(d.attr.toggled,d.attr.group(a))?"hidden":"visible"}).attr("clip-path","url(#clip)").on("mouseover",function(a,b){d3.select(this).style("opacity",.25),d.attr.tooltip&&d.attr.tooltip.html(d.attr.label(a,b)).style("visibility","visible").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mousemove",function(a){d.attr.tooltip&&d.attr.tooltip.style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-20+"px")}).on("mouseout",function(a){d3.select(this).style("opacity",d.attr.opacity),d.attr.tooltip&&d.attr.tooltip.style("visibility","hidden")}),d.attr.xdensity&&d.plotarea.selectAll(".xtick").remove().data(d.data).enter().append("line").attr("clip-path","url(#clip)").attr("class",function(a,b){return"xtick g_"+a.group}).attr("x1",function(a,b){return d.xscale(d.attr.x(a,b))}).attr("x2",function(a,b){return d.xscale(d.attr.x(a,b))}).attr("y1",function(a,b){return d.innerheight}).attr("y2",function(a,b){return d.innerheight-10}).attr("stroke",function(a,b){return d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return _.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}),d.attr.ydensity&&d.plotarea.selectAll(".ytick").remove().data(d.data).enter().append("line").attr("clip-path","url(#clip)").attr("class",function(a,b){return"ytick g_"+a.group}).attr("x1",function(a,b){return 0}).attr("x2",function(a,b){return 10}).attr("y1",function(a,b){return d.yscale(d.attr.y(a,b))}).attr("y2",function(a,b){return d.yscale(d.attr.y(a,b))}).attr("stroke",function(a,b){return d.pallette(d.attr.group(a,b))}).style("opacity",d.attr.opacity).style("visibility",function(a,b){return _.contains(d.attr.toggled,d.attr.group(a,b))?"hidden":"visible"}),0!=d.attr.lm&&a.error("Not yet implemented!")},this.go}a.debug=!1,a.error=function(a){console.log("ERROR: "+a)},a.log=function(b){a.debug&&console.log("DEBUG: "+b)},a.render=function(b){a.log("rendering element");var c=b();return"undefined"==typeof b.parent&&(a.plots[b.id()]=c),c},a.plots={},a.annotation=function(b){return a.log("creating plot annotation"),new c(b)};var n={16:"Shift",17:"Ctrl",18:"Alt",27:"Esc"},o={9:"Tab",13:"Enter",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z"},p=_.extend(_.clone(n),o);a.keys={},_.each(p,function(b){a.keys[b]=!1}),a.events={},_.each(n,function(b){a.events[b]={down:function(){},up:function(){}},_.each(o,function(c){a.events[b+c]={down:function(){},up:function(){}}})}),document.onkeydown=function(b){b=b||window.event;var c=b.which;_.has(p,c)&&(a.keys[p[c]]=!0,_.has(o,c)?_.each(n,function(b){a.keys[b]&&a.events[b+o[c]].down()}):a.events[p[c]].down())},document.onkeyup=function(b){b=b||window.event;var c=b.which;_.has(p,c)&&(a.keys[p[c]]=!1,_.has(o,c)?_.each(n,function(b){a.keys[b]&&a.events[b+o[c]].up()}):a.events[p[c]].up())};var q=Math.round(1e5*Math.random());a.seed=function(a){return arguments.length?void(q=a):q},a.random=function(){"undefined"==typeof q&&(q=42);var a=1e4*Math.sin(q++);return a-Math.floor(a)},a.uuid=function(){function b(){return Math.floor(65536*(1+a.random())).toString(16).substring(1)}return"u"+[b()+b(),b(),b(),b(),b()+b()+b()].join("-")},a["export"]=function(a,b){var c=a.attr({xmlns:"http://www.w3.org/2000/svg",version:"1.1"}).node(),d=c.cloneNode(!0);d3.select(d).selectAll("clippath").attr("id","clip-export"),d3.select(d).selectAll(".plotarea").attr("clip-path","url(#clip-export)"),d.id="export",document.body.appendChild(d),d3.select(d).style("background-color","#fff"),d3.select(d).selectAll(".glyphbox").remove(),d3.select(d).selectAll("text").style("font-weight",300).style("font-size","12px").style("font-family",'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif'),d3.select(d).selectAll(".axis line").style("stroke","#bbb").style("fill","none").style("shape-rendering","crispEdges"),d3.select(d).selectAll(".axis path").style("stroke","#bbb").style("fill","none").style("shape-rendering","crispEdges"),d3.select(d).selectAll(".axis .tick line").style("stroke","#bbb").style("opacity",.5),d3.select(d).selectAll(".selector").style("stroke","#bbb").style("stroke-width","1px"),d3.select(d).selectAll(".xtick").style("stroke-width","1.5px"),d3.select(d).selectAll(".ytick").style("stroke-width","1.5px");var e=document.createElement("canvas"),f=e.getContext("2d"),g=d.getBoundingClientRect(),h=(new XMLSerializer).serializeToString(d);e.width=g.width,e.height=g.height;var i=document.createElement("img");i.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h)))),i.onload=function(){f.drawImage(i,0,0);var a=e.toDataURL("image/png"),c=document.createElement("a");c.download=b+".png",c.href=a,document.body.appendChild(c),c.click(),c.remove(),e.remove(),document.body.removeChild(d)}},_.center=function(a,b){return _.min([_.max([a,b[0]]),b[1]])},_.uniquesort=function(a,b){return"undefined"==typeof b&&(b=function(a){return a}),_.unique(_.map(a,b)).sort()},d3.selection.prototype.stageup=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.stagedown=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},parameterize=function(a,b){Object.keys(a).forEach(function(c){b[c]=function(d){return arguments.length?("object"==typeof d&&"object"==typeof a[c]?(Array.isArray(a[c])&&!Array.isArray(d)&&(d=[d]),a[c]=_.extend(a[c],d)):a[c]=d,b):a[c]}})},extend=function(a,b){return _.map(Object.keys(b),function(c){"undefined"==typeof a[c]&&(a[c]=b[c])}),_.map(Object.keys(a),function(c){"undefined"!=typeof b[c]&&("object"!=typeof a[c]||Array.isArray(a[c])||null==a[c]?Array.isArray(a[c])&&!Array.isArray(b[c])?a[c]=[b[c]]:a[c]=b[c]:a[c]=extend(a[c],b[c]))}),a},g.prototype=Object.create(b.prototype),g.prototype.constructor=g,a.bar=function(a){return new g(a)},h.prototype=Object.create(j.prototype),h.prototype.constructor=h,a.density=function(a){return new h(a)},i.prototype=Object.create(g.prototype),i.prototype.constructor=i,a.histogram=function(a){return new i(a)},j.prototype=Object.create(b.prototype),j.prototype.constructor=j,a.line=function(a){return new j(a)},k.prototype=Object.create(b.prototype),k.prototype.constructor=k,a.multiline=function(a){return new k(a)},l.prototype=Object.create(b.prototype),l.prototype.constructor=l,a.pie=function(a){return new l(a)},m.prototype=Object.create(b.prototype),m.prototype.constructor=m,a.scatter=function(a){return new m(a)},a.version="0.0.1",window.quorra=a}();