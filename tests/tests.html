<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Quorra Testing</title>
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
    <link rel="stylesheet" href="../dist/quorra.css" />
    <style>
        .plotarea {
            width: 550px;
            height: 350px;
            margin-bottom: 20px;
            margin-top: 40px;
        }
    </style>

</head>
<body>
    <div id="mocha"></div>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script>
        mocha.ui('bdd'); 
        mocha.reporter('html');
        var expect = chai.expect;
    </script>

    <script src="../lib/d3/d3.min.js"></script>
    <script src="../lib/underscore/underscore-min.js"></script>
    <script src="../dist/quorra.js"></script>

    <!-- common -->
    <script src="./common/quorra.test.js"></script>
    <script src="./common/annotation.test.js"></script>
    <script src="./common/utils.test.js"></script>
    <script src="./common/events.test.js"></script>
    <script src="./common/stats.test.js"></script>

    <!-- models -->
    <script src="./models/bar.test.js"></script>
    <script src="./models/histogram.test.js"></script>
    <script src="./models/line.test.js"></script>
    <script src="./models/density.test.js"></script>
    <script src="./models/scatter.test.js"></script>
    <script src="./models/pie.test.js"></script>

    <script>
        function bind(ident) {
            var suite = d3.select('#mocha-report').selectAll('li.suite');
            if (typeof suite[0] == 'undefined'){
                var base = d3.select('body');
            } else if (suite[0].length == 1) {
                var base = suite.select('ul');
            } else {
                var base = d3.select(_.filter(suite[0], function(d) {
                  return d3.select(d).select('h1').select('a').text() == ident;
                })[0]).select('ul');
            }
            return base;
        }

        function reorder(base) {
            function swap(pre, post) {
                pre.parentNode.replaceChild(pre, post);
                pre.parentNode.insertBefore(post, pre);     
            }
            var nodes = base.node().childNodes;
            for (var i = 1; i < nodes.length; i=i+2) {
                swap(nodes[i-1], nodes[i]);
            }
        }

        function validate(id) {
            // select objects
            var svg = d3.selectAll('svg#' + id);
            d3expect(svg);
            var plotarea = svg.selectAll('g.plotarea');
            d3expect(plotarea);
            var glyphs = svg.selectAll('.glyphbox');
            d3expect(glyphs);
            
            // validate selections
            d3expect(svg.selectAll('g'));
            d3expect(svg.selectAll('clippath'));
            d3expect(svg.selectAll('symbol'));
            d3expect(plotarea.selectAll('.axis'));
            d3expect(plotarea.selectAll('.layer'));
            return;
        }

        function d3expect(selection) {
            if (typeof d3.select('#mocha-report').selectAll('li.suite')[0] == 'undefined') {
                // figure out another way to validate for phantom ...
                expect(42).to.be.equal(42);
            } else {
                expect(selection[0][0]).to.be.not.null();
            }
            return; 
        }

        quorra.seed(42);

        if (window.mochaPhantomJS) {
            mochaPhantomJS.run();
        } else {
            mocha.run();
        }
    </script>
</body>
</html>